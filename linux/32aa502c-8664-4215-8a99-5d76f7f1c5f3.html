<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Linux 文本处理 | Janvy's blog</title><meta name="keywords" content="Linux"><meta name="author" content="Janvy Sun"><meta name="copyright" content="Janvy Sun"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文介绍 Linux 中一些常用的文本处理工具"><meta property="og:type" content="article"><meta property="og:title" content="Linux 文本处理"><meta property="og:url" content="https://janvysun.github.io/linux/32aa502c-8664-4215-8a99-5d76f7f1c5f3.html"><meta property="og:site_name" content="Janvy&#39;s blog"><meta property="og:description" content="本文介绍 Linux 中一些常用的文本处理工具"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://janvysun.github.io/images/hexo.png"><meta property="article:published_time" content="2023-02-12T16:00:00.000Z"><meta property="article:modified_time" content="2023-02-12T16:00:00.000Z"><meta property="article:author" content="Janvy Sun"><meta property="article:tag" content="Linux"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://janvysun.github.io/images/hexo.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://janvysun.github.io/linux/32aa502c-8664-4215-8a99-5d76f7f1c5f3"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: [object Object]
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Linux 文本处理",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-02-13 00:00:00"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const n=864e5*o,a={value:t,expiry:(new Date).getTime()+n};localStorage.setItem(e,JSON.stringify(a))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise((t,o)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=o,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,t())},document.head.appendChild(n)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme");"dark"===t?activateDarkMode():"light"===t&&activateLightMode();const o=saveToLocal.get("aside-status");void 0!==o&&("hide"===o?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><meta name="generator" content="Hexo 6.1.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/avatar.jpg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">154</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">47</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background:linear-gradient(20deg,#0062be,#925696,#cc426e,#fb0347)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Janvy's blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Linux 文本处理</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-02-12T16:00:00.000Z" title="发表于 2023-02-13 00:00:00">2023-02-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-02-12T16:00:00.000Z" title="更新于 2023-02-13 00:00:00">2023-02-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/">Linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">13k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>64分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="Linux 文本处理"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="文本查看工具"><a href="#文本查看工具" class="headerlink" title="文本查看工具"></a>文本查看工具</h2><h3 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h3><p>cat 可以查看文本内容</p><p>格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat [OPTION]... [FILE]...</span><br></pre></td></tr></table></figure><h4 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h4><ul><li><code>-E</code>：显示行结束符<code>$</code></li><li><code>-A</code>：显示所有控制符</li><li><code>-n</code>：对显示出的每一行进行编号</li><li><code>-b</code>：非空行编号</li><li><code>-s</code>：压缩连续的空行成一行</li></ul><h3 id="tac"><a href="#tac" class="headerlink" title="tac"></a>tac</h3><p>逆向显示文本内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">seq 3 | tac</span><br><span class="line">&gt;&gt;&gt; 3</span><br><span class="line">&gt;&gt;&gt; 2</span><br><span class="line">&gt;&gt;&gt; 1</span><br></pre></td></tr></table></figure><h3 id="rev"><a href="#rev" class="headerlink" title="rev"></a>rev</h3><p>将同一行的内容逆向显示</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat /data/fa.txt</span><br><span class="line">&gt;&gt;&gt; 1 2 3 4 5</span><br><span class="line">&gt;&gt;&gt; a b c</span><br><span class="line">rev /data/fa.txt</span><br><span class="line">&gt;&gt;&gt; 5 4 3 2 1</span><br><span class="line">&gt;&gt;&gt; c b a</span><br></pre></td></tr></table></figure><h3 id="more"><a href="#more" class="headerlink" title="more"></a>more</h3><p>可以实现分页查看文件，可以配合管道实现输出信息的分页</p><p>格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">more [OPTIONS] FILE...</span><br></pre></td></tr></table></figure><p>选项：</p><ul><li><code>-d</code>: 显示翻页及退出提示</li></ul><h3 id="less"><a href="#less" class="headerlink" title="less"></a>less</h3><p>less 也可以实现分页查看文件或 STDIN 输出，less 命令是 man 命令使用的分页器</p><h3 id="head"><a href="#head" class="headerlink" title="head"></a>head</h3><p>可以显示文件或标准输入的前面行</p><p>格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head [OPTION]... [FILE]...</span><br></pre></td></tr></table></figure><h4 id="选项-1"><a href="#选项-1" class="headerlink" title="选项"></a>选项</h4><ul><li><code>-c #</code>：指定获取前 # 字节</li><li><code>-n #</code>：指定获取前 # 行，# 如果为 -n，表示从文件头取到倒数第 n 前</li><li><code>-#</code>：同上</li></ul><h4 id="范例"><a href="#范例" class="headerlink" title="范例"></a>范例</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 /etc/passwd 文件的前 3 行</span></span><br><span class="line"><span class="built_in">head</span> -n 3 /etc/passwd</span><br><span class="line"><span class="built_in">head</span> -n +3 /etc/passwd</span><br><span class="line"><span class="built_in">head</span> -3 /etc/passwd</span><br><span class="line"><span class="comment"># 查看 /etc/passwd 文件，从开始到倒数第 3 行</span></span><br><span class="line"><span class="built_in">head</span> -n -3 /etc/passwd</span><br><span class="line"><span class="comment"># 查看前 4 个字节</span></span><br><span class="line"><span class="built_in">echo</span> a我b | <span class="built_in">head</span> -c4</span><br><span class="line"><span class="comment"># 生成 10 字节大小写字母组成的随机数</span></span><br><span class="line"><span class="built_in">cat</span> /dev/urandom | <span class="built_in">tr</span> -dc <span class="string">&#x27;[:alnum:]&#x27;</span>| <span class="built_in">head</span> -c10</span><br><span class="line"><span class="built_in">cat</span> /dev/urandom | <span class="built_in">tr</span> -dc <span class="string">&#x27;[:alnum:]&#x27;</span>| <span class="built_in">head</span> -c10</span><br><span class="line"><span class="comment"># 生成随机数写入 pass.txt 文件中，并且将此随机数设置成 test 用户的密码</span></span><br><span class="line"><span class="built_in">cat</span> /dev/urandom | <span class="built_in">tr</span> -dc <span class="string">&#x27;[:alnum:]&#x27;</span>| <span class="built_in">head</span> -c10 | <span class="built_in">tee</span> pass.txt | passwd --stdin <span class="built_in">test</span></span><br></pre></td></tr></table></figure><h3 id="tail"><a href="#tail" class="headerlink" title="tail"></a>tail</h3><p>tail 和head 相反，查看文件或标准输入的倒数行</p><p>格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail [OPTION]... [FILE]...</span><br></pre></td></tr></table></figure><h4 id="选项-2"><a href="#选项-2" class="headerlink" title="选项"></a>选项</h4><ul><li><code>-c #</code>：指定获取后 # 字节</li><li><code>-n #</code>：指定获取后 # 行，如果 # 是 +n ，则表示从第 n 行开始到文件结束</li><li><code>-#</code>：同上</li><li><code>-f</code>：跟踪显示文件 fd 新追加的内容，常用日志监控，相当于 –follow&#x3D;descriptor，当文件删除再新建同名文件，将无法继续跟踪文件</li><li><code>-F</code>：跟踪文件名，相当于–follow&#x3D;name –retry，当文件删除再新建同名文件，将可以继续跟踪文件</li></ul><h4 id="范例-1"><a href="#范例-1" class="headerlink" title="范例"></a>范例</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看文件最后 3 行</span></span><br><span class="line"><span class="built_in">tail</span> -3 /var/log/messages</span><br><span class="line"><span class="built_in">tail</span> -n 3 /var/log/messages</span><br><span class="line"><span class="built_in">tail</span> -n -3 /var/log/messages</span><br><span class="line"><span class="comment"># 查看文件从第 3 行开始直到最后</span></span><br><span class="line"><span class="built_in">tail</span> -n +3 /var/log/messages</span><br><span class="line"><span class="comment"># 持续跟踪文件</span></span><br><span class="line"><span class="built_in">tail</span> -f /var/log/messages</span><br><span class="line"><span class="comment">#只查看最新发生的日志</span></span><br><span class="line"><span class="built_in">tail</span> -fn0 /var/log/messages</span><br><span class="line"><span class="built_in">tail</span> -0f /var/log/messages</span><br><span class="line"><span class="comment"># 取 IP 所在行</span></span><br><span class="line">ifconfig | <span class="built_in">head</span> -2 | <span class="built_in">tail</span> -1                                 </span><br><span class="line">ifconfig | <span class="built_in">tail</span> -n +2 | <span class="built_in">head</span> -1</span><br><span class="line"><span class="comment"># 查看第 6 行</span></span><br><span class="line"><span class="built_in">seq</span> 20 | <span class="built_in">head</span> -n 6 | <span class="built_in">tail</span> -1</span><br><span class="line"><span class="built_in">seq</span> 20 | <span class="built_in">tail</span> -n +6 | <span class="built_in">head</span> -1</span><br></pre></td></tr></table></figure><h3 id="cut"><a href="#cut" class="headerlink" title="cut"></a>cut</h3><p>cut 命令可以提取文本文件或 STDIN 数据的指定列</p><p>格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cut [OPTION]... [FILE]...</span><br></pre></td></tr></table></figure><h4 id="选项-3"><a href="#选项-3" class="headerlink" title="选项"></a>选项</h4><ul><li><code>-d DELIMITER</code>: 指明分隔符，默认tab</li><li><code>-f FILEDS</code>:<br><code>#</code>: 第#个字段,例如:3<br><code>#,#[,#]</code>：离散的多个字段，例如:<code>1,3,6</code><br><code>#-#</code>：连续的多个字段, 例如:<code>1-6</code><br>混合使用：<code>1-3,7</code></li><li><code>-c</code>：按字符切割</li><li><code>--output-delimiter=STRING</code>：指定输出分隔符</li></ul><h4 id="范例-2"><a href="#范例-2" class="headerlink" title="范例"></a>范例</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cut</span> -d: -f1,3-4,7 /etc/passwd </span><br><span class="line"><span class="comment"># 取本机 ip 地址</span></span><br><span class="line">ifconfig |<span class="built_in">head</span> -n2 |<span class="built_in">tail</span> -n1|<span class="built_in">cut</span> -d<span class="string">&quot; &quot;</span> -f10</span><br><span class="line">ifconfig |<span class="built_in">head</span> -n2 |<span class="built_in">tail</span> -n1|<span class="built_in">tr</span> -s <span class="string">&quot; &quot;</span> |<span class="built_in">cut</span> -d <span class="string">&quot; &quot;</span> -f3</span><br><span class="line"><span class="comment"># 查看 passwd 文件，以:号分隔，输出1,3,7列，并将分隔符替换成 ---</span></span><br><span class="line"><span class="built_in">cut</span> -d: -f1,3,7 --output-delimiter=<span class="string">&quot;---&quot;</span> /etc/passwd</span><br><span class="line"><span class="comment"># 查看 passwd 文件第7列</span></span><br><span class="line"><span class="built_in">cat</span> /etc/passwd | <span class="built_in">cut</span> -d: -f7</span><br><span class="line"><span class="built_in">cut</span> -c2-5 /usr/share/dict/words</span><br><span class="line"><span class="comment"># 将 1~10 中的空格换成 + 号，然后通过 bc 计算 1~10 的和</span></span><br><span class="line"><span class="built_in">echo</span> &#123;1..10&#125; | <span class="built_in">cut</span> -d <span class="string">&#x27; &#x27;</span> -f1-10 --output-delimiter=<span class="string">&quot;+&quot;</span> | bc</span><br><span class="line"><span class="comment">#取分区利用率</span></span><br><span class="line"><span class="built_in">df</span> | <span class="built_in">cut</span> -c44-46 | <span class="built_in">tr</span> -d <span class="string">&#x27;[:alpha:]&#x27;</span></span><br><span class="line"><span class="built_in">df</span> | <span class="built_in">tr</span> -s <span class="string">&#x27; &#x27;</span>| <span class="built_in">cut</span> -d<span class="string">&#x27; &#x27;</span> -f5 | <span class="built_in">tr</span> -dc <span class="string">&quot;[0-9\n]&quot;</span></span><br><span class="line"><span class="built_in">df</span> | <span class="built_in">tr</span> -s <span class="string">&#x27; &#x27;</span> % | <span class="built_in">cut</span> -d% -f5 | <span class="built_in">tr</span> -d <span class="string">&#x27;[:alpha:]&#x27;</span></span><br><span class="line"><span class="built_in">df</span> | <span class="built_in">tr</span> -s <span class="string">&#x27; &#x27;</span> |<span class="built_in">cut</span> -d<span class="string">&#x27; &#x27;</span> -f5 | <span class="built_in">tr</span> -d %</span><br><span class="line"><span class="built_in">df</span> | <span class="built_in">tr</span> -s <span class="string">&#x27; &#x27;</span> <span class="string">&#x27;%&#x27;</span> | <span class="built_in">cut</span> -d% -f5</span><br><span class="line"><span class="built_in">df</span> | <span class="built_in">cut</span> -c 44-46 | <span class="built_in">tail</span> -n +2</span><br><span class="line"><span class="built_in">df</span> | <span class="built_in">tail</span> -n +2 | <span class="built_in">tr</span> -s <span class="string">&#x27; &#x27;</span> % | <span class="built_in">cut</span> -d% -f5</span><br><span class="line"><span class="built_in">df</span> | <span class="built_in">tail</span> -n +2 | <span class="built_in">tr</span> -s <span class="string">&#x27; &#x27;</span> | <span class="built_in">cut</span> -d<span class="string">&#x27; &#x27;</span> -f5 | <span class="built_in">tr</span> -d %</span><br></pre></td></tr></table></figure><h3 id="paste"><a href="#paste" class="headerlink" title="paste"></a>paste</h3><p>paste 合并多个文件同行号的列到一行</p><p>格式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">paste [OPTION]... [FILE]...</span><br></pre></td></tr></table></figure><h4 id="选项-4"><a href="#选项-4" class="headerlink" title="选项"></a>选项</h4><ul><li><code>-d#分隔符</code>：指定分隔符，默认用TAB</li><li><code>-s</code>：所有行合成一行显示</li></ul><h4 id="范例-3"><a href="#范例-3" class="headerlink" title="范例"></a>范例</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将 alpha 与 seq 文件按列合并</span></span><br><span class="line"><span class="built_in">paste</span> alpha.log seq.log</span><br><span class="line">&gt;&gt;&gt; a 1</span><br><span class="line">&gt;&gt;&gt; b 2</span><br><span class="line">&gt;&gt;&gt; c 3</span><br><span class="line">&gt;&gt;&gt; d 4</span><br><span class="line">&gt;&gt;&gt; e 5</span><br><span class="line">&gt;&gt;&gt; f </span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并两文件，并使用:分隔符</span></span><br><span class="line"><span class="built_in">paste</span> -d<span class="string">&quot;:&quot;</span> alpha.log seq.log </span><br><span class="line">&gt;&gt;&gt; a:1</span><br><span class="line">&gt;&gt;&gt; b:2</span><br><span class="line">&gt;&gt;&gt; c:3</span><br><span class="line">&gt;&gt;&gt; d:4</span><br><span class="line">&gt;&gt;&gt; e:5</span><br><span class="line">&gt;&gt;&gt; f:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 两文件按行合并</span></span><br><span class="line"><span class="built_in">paste</span> -s alpha.log seq.log</span><br><span class="line">&gt;&gt;&gt; a b c d e f g h</span><br><span class="line">&gt;&gt;&gt; 1 2 3 4 5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 两文件按行合并且使用:号分隔符</span></span><br><span class="line"><span class="built_in">paste</span> -s -d: f1.log f2.log</span><br><span class="line">&gt;&gt;&gt; 1:2:3:4:5:6:7:8:9:10</span><br><span class="line">&gt;&gt;&gt; a:b:c:d:e:f:g:h:i:j</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算 1~10 的和</span></span><br><span class="line"><span class="built_in">seq</span> 10 | <span class="built_in">paste</span> -s -d+ | bc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 批量修改密码</span></span><br><span class="line"><span class="built_in">paste</span> -d: user.txt pass.txt</span><br><span class="line">&gt;&gt;&gt; wang:123456</span><br><span class="line">&gt;&gt;&gt; mage:magedu</span><br><span class="line"><span class="built_in">paste</span> -d: user.txt pass.txt | chpasswd</span><br></pre></td></tr></table></figure><br><h2 id="文本分析工具"><a href="#文本分析工具" class="headerlink" title="文本分析工具"></a>文本分析工具</h2><h3 id="wc"><a href="#wc" class="headerlink" title="wc"></a>wc</h3><p>wc 命令可用于统计文件的行总数、单词总数、字节总数和字符总数</p><p>可以对文件或 STDIN 中的数据统计</p><h4 id="选项-5"><a href="#选项-5" class="headerlink" title="选项"></a>选项</h4><ul><li><code>-l</code>：只计数行数</li><li><code>-w</code>：只计数单词总数</li><li><code>-c</code>：只计数字节总数</li><li><code>-m</code>：只计数字符总数</li><li><code>-L</code>：显示文件中最长行的长度</li></ul><h4 id="范例-4"><a href="#范例-4" class="headerlink" title="范例"></a>范例</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 统计文件行数</span></span><br><span class="line"><span class="built_in">wc</span> -l title.txt </span><br><span class="line"><span class="built_in">cat</span> title.txt | <span class="built_in">wc</span> -l</span><br><span class="line"></span><br><span class="line"><span class="built_in">df</span> | <span class="built_in">tail</span> -n $(<span class="built_in">echo</span> `<span class="built_in">df</span> | <span class="built_in">wc</span> -l`-1 | bc) </span><br><span class="line">&gt;&gt;&gt; /dev/sda2      104806400 4836160  99970240   5% /</span><br><span class="line">&gt;&gt;&gt; /dev/sda3       52403200  398580  52004620   1% /data</span><br><span class="line">&gt;&gt;&gt; /dev/sda1         999320  131764    798744  15% /boot</span><br></pre></td></tr></table></figure><h3 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h3><p>排序，把整理过的文本显示在 STDOUT，不改变原始文件</p><p>格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sort [OPTIONS] [FILE]...</span><br></pre></td></tr></table></figure><h4 id="选项-6"><a href="#选项-6" class="headerlink" title="选项"></a>选项</h4><ul><li><code>-r</code>：执行反方向（由上至下）整理</li><li><code>-R</code>：随机排序</li><li><code>-n</code>：执行按数字大小整理</li><li><code>-h</code>：人类可读排序,如: 2K 1G</li><li><code>-f</code>：fold，忽略字符串中的字符大小写</li><li><code>-u</code>：unique，合并重复项，即去重</li><li><code>-t c</code>：选项使用 c 做为字段界定符</li><li><code>-k #</code>：选项按照使用 c 字符分隔的 # 列来整理能够使用多次</li></ul><h4 id="范例-5"><a href="#范例-5" class="headerlink" title="范例"></a>范例</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cut</span> -d: -f1,3 /etc/passwd | <span class="built_in">sort</span> -t: -k2 -nr | <span class="built_in">head</span> -n3</span><br><span class="line">&gt;&gt;&gt; nobody:65534</span><br><span class="line">&gt;&gt;&gt; xiaoming:1002</span><br><span class="line">&gt;&gt;&gt; mage:1001</span><br><span class="line"><span class="comment">#统计日志访问量</span></span><br><span class="line"><span class="built_in">cut</span> -d<span class="string">&quot; &quot;</span> -f1 /var/log/nginx/access_log |<span class="built_in">sort</span> -u|<span class="built_in">wc</span> -l</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看分区利用率最高值</span></span><br><span class="line"><span class="built_in">df</span> | <span class="built_in">tr</span> -s <span class="string">&#x27; &#x27;</span> <span class="string">&#x27;%&#x27;</span> | <span class="built_in">cut</span> -d% -f5 | <span class="built_in">sort</span> -nr | <span class="built_in">head</span> -1</span><br><span class="line"><span class="built_in">df</span> | <span class="built_in">tr</span> -s <span class="string">&quot; &quot;</span> % | <span class="built_in">cut</span> -d% -f5 | <span class="built_in">tr</span> -d <span class="string">&#x27;[:alpha:]&#x27;</span> | <span class="built_in">sort</span></span><br><span class="line"><span class="built_in">df</span> | <span class="built_in">tr</span> -s <span class="string">&quot; &quot;</span> % | <span class="built_in">cut</span> -d% -f5 | <span class="built_in">tr</span> -d <span class="string">&#x27;[:alpha:]&#x27;</span> | <span class="built_in">sort</span> -n</span><br><span class="line"><span class="built_in">df</span> | <span class="built_in">tr</span> -s <span class="string">&quot; &quot;</span> % | <span class="built_in">cut</span> -d% -f5 | <span class="built_in">tr</span> -d <span class="string">&#x27;[:alpha:]&#x27;</span> | <span class="built_in">sort</span> -n | <span class="built_in">tail</span> -n1</span><br><span class="line"><span class="built_in">df</span> | <span class="built_in">tr</span> -s <span class="string">&quot; &quot;</span> % | <span class="built_in">cut</span> -d% -f5 | <span class="built_in">tr</span> -d <span class="string">&#x27;[:alpha:]&#x27;</span> | <span class="built_in">sort</span> -nr</span><br><span class="line"><span class="built_in">df</span> | <span class="built_in">tr</span> -s <span class="string">&quot; &quot;</span> % | <span class="built_in">cut</span> -d% -f5 | <span class="built_in">tr</span> -d <span class="string">&#x27;[:alpha:]&#x27;</span> | <span class="built_in">sort</span> -nr | <span class="built_in">head</span> -n1</span><br></pre></td></tr></table></figure><h3 id="uniq"><a href="#uniq" class="headerlink" title="uniq"></a>uniq</h3><p>uniq 命令从输入中删除前后相接的重复的行</p><p>格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uniq [OPTION]... [FILE]...</span><br></pre></td></tr></table></figure><h4 id="选项-7"><a href="#选项-7" class="headerlink" title="选项"></a>选项</h4><ul><li><code>-c</code>: 显示每行重复出现的次数</li><li><code>-d</code>: 仅显示重复过的行</li><li><code>-u</code>: 仅显示不曾重复的行</li></ul><h4 id="范例-6"><a href="#范例-6" class="headerlink" title="范例"></a>范例</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># uniq 常和 sort 命令一起配合使用</span></span><br><span class="line"><span class="built_in">sort</span> userlist.txt | <span class="built_in">uniq</span> -c</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计日志访问量最多的请求</span></span><br><span class="line"><span class="built_in">cut</span> -d<span class="string">&quot; &quot;</span> -f1 access_log |<span class="built_in">sort</span> |<span class="built_in">uniq</span> -c|<span class="built_in">sort</span> -nr |<span class="built_in">head</span> -3</span><br><span class="line">&gt;&gt;&gt; 4870 172.20.116.228</span><br><span class="line">&gt;&gt;&gt; 3429 172.20.116.208</span><br><span class="line">&gt;&gt;&gt; 2834 172.20.0.222</span><br><span class="line"></span><br><span class="line"><span class="comment"># 并发连接最多的远程主机 IP</span></span><br><span class="line">ss -nt|<span class="built_in">tail</span> -n+2 |<span class="built_in">tr</span> -s <span class="string">&#x27; &#x27;</span> : |<span class="built_in">cut</span> -d: -f6|<span class="built_in">sort</span>|<span class="built_in">uniq</span> -c|<span class="built_in">sort</span> -nr |<span class="built_in">head</span> -n2</span><br><span class="line">&gt;&gt;&gt; 7 10.0.0.1</span><br><span class="line">&gt;&gt;&gt; 2 10.0.0.7</span><br><span class="line"></span><br><span class="line"><span class="comment">#取文件的共同行</span></span><br><span class="line"><span class="built_in">cat</span> test1.txt test2.txt | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -d</span><br><span class="line"><span class="comment">#取文件的不同行</span></span><br><span class="line"><span class="built_in">cat</span> test1.txt test2.txt | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -u</span><br></pre></td></tr></table></figure><br><h2 id="文本处理工具"><a href="#文本处理工具" class="headerlink" title="文本处理工具"></a>文本处理工具</h2><p>grep、sed、awk 并称为 linux 文本处理三剑客</p><h3 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h3><p>grep: (Global search REgular expression and Print out the line) 作用：根据用户指定的“模式”对目标文本逐行进行匹配检查，打印匹配到的行</p><p>其中的模式是指<strong>由正则表达式字符及文本字符所编写的过滤条件</strong></p><p>格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep [OPTIONS] PATTERN [FILE...]</span><br></pre></td></tr></table></figure><h4 id="选项-8"><a href="#选项-8" class="headerlink" title="选项"></a>选项</h4><ul><li><code>-color=auto</code>：对匹配到的文本着色显示</li><li><code>-m #</code>：匹配 # 次后停止</li><li><code>-v</code>：显示不被pattern匹配到的行,即取反</li><li><code>-i</code>：忽略字符大小写</li><li><code>-n</code>：显示匹配的行号</li><li><code>-c</code>：统计匹配的行数</li><li><code>-o</code>：仅显示匹配到的字符串</li><li><code>-q</code>：静默模式，不输出任何信息</li><li><code>-A #</code>：after, 后#行</li><li><code>-B #</code>：before, 前#行</li><li><code>-C #</code>：context, 前后各#行</li><li><code>-e</code> 实现多个选项间的逻辑or关系,如：grep –e ‘cat ‘ -e ‘dog’ file</li><li><code>-w</code> 匹配整个单词</li><li><code>-E</code> 使用ERE，相当于egrep</li><li><code>-F</code> 不支持正则表达式，相当于fgrep</li><li><code>-f file</code>：根据模式文件处理</li><li><code>-r</code>：递归目录，但不处理软链接</li><li><code>-R</code>：递归目录，但处理软链接</li></ul><h4 id="范例-7"><a href="#范例-7" class="headerlink" title="范例"></a>范例</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 搜索文本中包含某内容的行</span></span><br><span class="line">grep root /etc/passwd</span><br><span class="line">grep <span class="string">&quot;USER&quot;</span> /etc/passwd</span><br><span class="line">grep <span class="string">&#x27;USER&#x27;</span> /etc/passwd</span><br><span class="line">grep <span class="built_in">whoami</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取两个文件的相同行</span></span><br><span class="line">grep -f /data/f1.txt /data/f2.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分区利用率最大的值</span></span><br><span class="line"><span class="built_in">df</span> | grep <span class="string">&#x27;^/dev/sd&#x27;</span> | <span class="built_in">tr</span> -s <span class="string">&#x27; &#x27;</span> %| <span class="built_in">cut</span> -d% -f5 | <span class="built_in">sort</span> -n | <span class="built_in">tail</span> -1</span><br><span class="line"><span class="built_in">df</span> | grep <span class="string">&#x27;^/dev/sd&#x27;</span> | grep -oE <span class="string">&#x27;\&lt;[0-9]&#123;,3&#125;%&#x27;</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;%&#x27;</span> | <span class="built_in">sort</span> -nr | <span class="built_in">head</span> -n1</span><br><span class="line"><span class="built_in">df</span> | grep <span class="string">&#x27;^/dev/sd&#x27;</span> | grep -oE <span class="string">&#x27;\&lt;[0-9]&#123;,3&#125;%&#x27;</span> | grep -Eo <span class="string">&#x27;[0-9]+&#x27;</span> | <span class="built_in">sort</span> -nr | <span class="built_in">head</span> -n1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 哪个IP和当前主机连接数最多的前三位</span></span><br><span class="line">ss -nt | grep <span class="string">&quot;^ESTAB&quot;</span> | <span class="built_in">tr</span> -s <span class="string">&#x27; &#x27;</span> : | <span class="built_in">cut</span> -d: -f6 | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -nr | <span class="built_in">head</span> -n3</span><br><span class="line">&gt;&gt;&gt; 3 10.0.0.1</span><br><span class="line">&gt;&gt;&gt; 1 172.16.4.100</span><br><span class="line">&gt;&gt;&gt; 1 172.16.31.188</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接状态的统计</span></span><br><span class="line">ss -nta | grep -v <span class="string">&#x27;^State&#x27;</span> | <span class="built_in">cut</span> -d<span class="string">&quot; &quot;</span> -f1 | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c</span><br><span class="line">ss -nta | <span class="built_in">tail</span> -n +2 | <span class="built_in">cut</span> -d<span class="string">&quot; &quot;</span> -f1 | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c</span><br><span class="line">&gt;&gt;&gt; 7 ESTAB</span><br><span class="line">&gt;&gt;&gt; 4 LISTEN</span><br><span class="line">&gt;&gt;&gt; 7 TIME-WAIT</span><br><span class="line"></span><br><span class="line">grep -v <span class="string">&quot;^#&quot;</span> /etc/profile | grep -v <span class="string">&#x27;^$&#x27;</span></span><br><span class="line">grep -v <span class="string">&quot;^#\|^$&quot;</span> /etc/profile</span><br><span class="line">grep -v <span class="string">&quot;^\(#\|$\)&quot;</span> /etc/profile </span><br><span class="line">grep -Ev <span class="string">&quot;^(#|$)&quot;</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 找出文本中匹配模式的内容</span></span><br><span class="line">grep -o <span class="string">&#x27;r..t&#x27;</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">ifconfig | grep -E <span class="string">&#x27;[0-9]&#123;1,3&#125;.[0-9]&#123;1,3&#125;.[0-9]&#123;1,3&#125;.[0-9]&#123;1,3&#125;&#x27;</span></span><br><span class="line">ifconfig | grep -E <span class="string">&#x27;([0-9]&#123;1,3&#125;.)&#123;3&#125;[0-9]&#123;1,3&#125;&#x27;</span></span><br><span class="line">ifconfig eth0 | grep -Eo <span class="string">&#x27;([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;&#x27;</span>|<span class="built_in">head</span> -1</span><br><span class="line">&gt;&gt;&gt; inet 10.0.0.8 netmask 255.255.255.0 broadcast 10.0.0.255</span><br><span class="line">&gt;&gt;&gt; inet 172.16.0.123 netmask 255.255.0.0 broadcast 172.16.255.255</span><br><span class="line">&gt;&gt;&gt; inet6 fe80::c11e:4792:7e77:12a4 prefixlen 64 scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">&gt;&gt;&gt; inet 127.0.0.1 netmask 255.0.0.0</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> regex.txt </span><br><span class="line">&gt;&gt;&gt; ([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;</span><br><span class="line">ifconfig | grep -oEf regex.txt </span><br><span class="line">&gt;&gt;&gt; 10.0.0.8</span><br><span class="line">&gt;&gt;&gt; 255.255.255.0</span><br><span class="line">&gt;&gt;&gt; 10.0.0.255</span><br><span class="line">&gt;&gt;&gt; 127.0.0.1</span><br><span class="line">&gt;&gt;&gt; 255.0.0.0</span><br><span class="line"></span><br><span class="line">grep -E <span class="string">&#x27;root|bash&#x27;</span> /etc/passwd</span><br><span class="line">grep -e <span class="string">&#x27;root&#x27;</span> -e <span class="string">&#x27;bash&#x27;</span> /etc/passwd</span><br><span class="line">grep -w root /etc/passwd</span><br><span class="line">grep <span class="string">&#x27;\&lt;root\&gt;&#x27;</span> /etc/passwd</span><br><span class="line">grep <span class="string">&quot;^\(.*\)\&gt;.*\&lt;\1$&quot;</span> /etc/passwd</span><br><span class="line">grep -E <span class="string">&quot;^(.*)\&gt;.*\&lt;\1$&quot;</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 算出所有人的年龄总和</span></span><br><span class="line"><span class="built_in">cat</span> /data/age.txt</span><br><span class="line">&gt;&gt;&gt; xiaoming=20</span><br><span class="line">&gt;&gt;&gt; xiaohong=18</span><br><span class="line">&gt;&gt;&gt; xiaoqiang=22</span><br><span class="line"><span class="built_in">cut</span> -d<span class="string">&quot;=&quot;</span> -f2 /data/age.txt|<span class="built_in">tr</span> <span class="string">&#x27;\n&#x27;</span> + | grep -Eo <span class="string">&quot;.*[0-9]&quot;</span>|bc</span><br><span class="line">grep -Eo <span class="string">&quot;[0-9]+&quot;</span> /data/age.txt | <span class="built_in">tr</span> <span class="string">&#x27;\n&#x27;</span> + | grep -Eo <span class="string">&quot;.*[0-9]&quot;</span>|bc</span><br><span class="line">grep -oE <span class="string">&#x27;[0-9]+&#x27;</span> /data/age.txt| <span class="built_in">paste</span> -s -d+|bc</span><br></pre></td></tr></table></figure><h3 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h3><p>sed 即 Stream EDitor，和 vi 不同，sed 是行编辑器</p><p>Sed 是从文件或管道中读取一行，处理一行，输出一行；再读取一行，再处理一行，再输出一行，直到最后一行。</p><p>每当处理一行时，把当前处理的行存储在临时缓冲区中，称为模式空间（Pattern Space），接着用 sed 命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。</p><p>一次处理一行的设计模式使得 sed 性能很高，sed 在读取大文件时不会出现卡顿的现象。如果使用 vi 命令打开几十 M 上百 M 的文件，明显会出现有卡顿的现象，这是因为 vi 命令打开文件是一次性将文件加载到内存，然后再打开。Sed 就避免了这种情况，一行一行的处理，打开速度非常快，执行速度也很快</p><p>格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed [option]... &#x27;script;script;...&#x27; [inputfile...]</span><br></pre></td></tr></table></figure><p>script格式： <code>&#39;AddressCommand&#39;</code>，即 ‘地址命令’</p><h4 id="常用选项"><a href="#常用选项" class="headerlink" title="常用选项"></a>常用选项</h4><ul><li><code>-n</code>：不输出模式空间内容到屏幕，即不自动打印</li><li><code>-e</code>：多点编辑</li><li><code>-f FILE</code>：从指定文件中读取编辑脚本</li><li><code>-r, -E</code>：使用扩展正则表达式</li><li><code>-i.bak</code>：备份文件并原处编辑</li><li><code>-s</code>：将多个文件视为独立文件，而不是单个连续的长文件流</li></ul><p><strong>注意</strong></p><ul><li><code>-ir</code>不支持</li><li><code>-i -r</code>支持</li><li><code>-ri</code>支持</li><li><code>-ni</code>会清空文件</li></ul><h4 id="地址-Address"><a href="#地址-Address" class="headerlink" title="地址(Address)"></a>地址(Address)</h4><p>有如下 4 种：</p><ol><li>不给地址：对全文进行处理</li><li>单地址：<ul><li><code>#</code>：指定的行</li><li><code>$</code>：最后一行</li><li><code>/pattern/</code>：被此处模式所能够匹配到的每一行</li></ul></li><li>地址范围：<ul><li><code>#,#</code>：从 # 行到第 # 行，<code>3,6</code> 从第3行到第6行</li><li><code>#,+#</code>：从 # 行到 +# 行，<code>3,+4</code> 表示从3行到第7行</li><li><code>/pat1/,/pat2/</code>：从 pat1 匹配的行到 pat2 匹配的行</li><li><code>#,/pat/</code>：从 # 行到 pat 匹配的行</li><li><code>/pat/,#</code>：从pat匹配的行到 # 行</li></ul></li><li>步进：<code>~</code><ul><li><code>1~2</code>：奇数行</li><li><code>2~2</code>：偶数行</li></ul></li></ol><h4 id="命令-Command"><a href="#命令-Command" class="headerlink" title="命令(Command)"></a>命令(Command)</h4><ul><li><code>p</code>：打印当前模式空间内容，追加到默认输出之后</li><li><code>Ip</code>：忽略大小写输出</li><li><code>d</code>：删除模式空间匹配的行，并立即启用下一轮循环</li><li><code>a [\]text</code>：在指定行后面追加文本，支持使用<code>\n</code>实现多行追加</li><li><code>i [\]text</code>：在行前面插入文本</li><li><code>c [\]text</code>：替换行为单行或多行文本</li><li><code>w file</code>：保存模式匹配的行至指定文件</li><li><code>r file</code>：读取指定文件的文本至模式空间中匹配到的行后</li><li><code>=</code>：为模式空间中的行打印行号</li><li><code>!</code>：模式空间中匹配行取反处理</li><li><code>q</code>：结束或退出 sed</li></ul><h4 id="查找替换"><a href="#查找替换" class="headerlink" title="查找替换"></a>查找替换</h4><p>格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s/pattern/string/修饰符</span><br></pre></td></tr></table></figure><p>支持使用其它分隔符，可以是其它形式：<code>s@@@，s###</code></p><p>替换修饰符：</p><ul><li><code>g</code>：行内全局替换</li><li><code>p</code>：显示替换成功的行</li><li><code>w /PATH/FILE</code>：将替换成功的行保存至文件中</li><li><code>I,i</code>：忽略大小写</li></ul><h4 id="范例-8"><a href="#范例-8" class="headerlink" title="范例"></a>范例</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;&#x27;</span> /etc/issue</span><br><span class="line">sed <span class="string">&#x27;p&#x27;</span> /etc/issue</span><br><span class="line">sed -n <span class="string">&#x27;&#x27;</span> /etc/issue</span><br><span class="line">sed -n <span class="string">&#x27;p&#x27;</span> /etc/issue</span><br><span class="line">sed -n <span class="string">&#x27;1p&#x27;</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">ifconfig eth0 | sed <span class="string">&#x27;2p&#x27;</span></span><br><span class="line">ifconfig eth0 | sed -n <span class="string">&#x27;2p&#x27;</span></span><br><span class="line">        </span><br><span class="line">sed -n <span class="string">&#x27;$p&#x27;</span> /etc/passwd</span><br><span class="line">postfix:x:89:89::/var/spool/postfix:/sbin/nologin</span><br><span class="line"><span class="comment">#倒数第二行</span></span><br><span class="line">sed -n <span class="string">&quot;<span class="subst">$(echo $[`cat /etc/passwd|wc -l`-1])</span>p&quot;</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">ifconfig eth0 |sed -n <span class="string">&#x27;/netmask/p&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">df</span> | sed -n <span class="string">&#x27;/^\/dev\/sd/p&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | sed -n <span class="string">&#x27;3,6p&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | sed -n <span class="string">&#x27;3,+4p&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | sed -n <span class="string">&#x27;3,$p&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 |sed -n <span class="string">&#x27;1~2p&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 |sed -n <span class="string">&#x27;2~2p&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 |sed   <span class="string">&#x27;1~2d&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 |sed   <span class="string">&#x27;2~2d&#x27;</span></span><br><span class="line">sed -e <span class="string">&#x27;2d&#x27;</span> -e <span class="string">&#x27;4d&#x27;</span> seq.log</span><br><span class="line">sed <span class="string">&#x27;2d;4d&#x27;</span> seq.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#不显示注释行和空行</span></span><br><span class="line">sed <span class="string">&#x27;/^#/d;/^$/d&#x27;</span> /etc/httpd/conf/httpd.conf</span><br><span class="line">grep -Ev <span class="string">&#x27;^#|^$&#x27;</span> /etc/httpd/conf/httpd.conf</span><br><span class="line"></span><br><span class="line">sed -i.orig <span class="string">&#x27;2d;4d&#x27;</span> seq.log</span><br><span class="line"><span class="built_in">cat</span> seq.log.orig</span><br><span class="line"><span class="built_in">cat</span> seq.log</span><br><span class="line"><span class="built_in">seq</span> 10 &gt; seq.log </span><br><span class="line">sed -i.orig <span class="string">&#x27;2d;4d&#x27;</span> seq.log</span><br><span class="line">sed -i   <span class="string">&#x27;/^listen 9527/a listen 80 \nlisten 8080&#x27;</span> /etc/httpd/conf/httpd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除所有以#开头的行</span></span><br><span class="line">sed -i <span class="string">&#x27;/^#/d&#x27;</span> fstab</span><br><span class="line"><span class="comment"># 只显示非#开头的行</span></span><br><span class="line">sed -n <span class="string">&#x27;/^#/!p&#x27;</span> fstab</span><br><span class="line"><span class="comment"># 修改网卡配置</span></span><br><span class="line">sed -Ei.bak <span class="string">&#x27;/^GRUB_CMDLINE_LINUX/s/(.*)(&quot;)$/\1net.ifnames=0\2/&#x27;</span> /etc/default/grub</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索替换和&amp;</span></span><br><span class="line">sed -nr <span class="string">&#x27;s/r..t/&amp;er/gp&#x27;</span> /etc/passwd</span><br><span class="line">&gt;&gt;&gt; rooter:x:0:0:rooter:/rooter:/bin/bash</span><br><span class="line">&gt;&gt;&gt; operator:x:11:0:operator:/rooter:/sbin/nologin</span><br><span class="line">&gt;&gt;&gt; ftp:x:14:50:FTP User:/var/fterp:/sbin/nologin</span><br><span class="line"><span class="comment"># 获取分区利用率</span></span><br><span class="line"><span class="built_in">df</span> | sed -En <span class="string">&#x27;/^\/dev\/sd/s@.* ([0-9]+)%.*@\1@p&#x27;</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;2p&#x27;</span> /etc/passwd</span><br><span class="line">sed  -n <span class="string">&#x27;2p&#x27;</span> /etc/passwd</span><br><span class="line">sed  -n <span class="string">&#x27;1,4p&#x27;</span> /etc/passwd</span><br><span class="line">sed  -n <span class="string">&#x27;/root/p&#x27;</span> /etc/passwd</span><br><span class="line">sed  -n <span class="string">&#x27;2,/root/p&#x27;</span> /etc/passwd 从2行开始</span><br><span class="line">sed  -n <span class="string">&#x27;/^$/=&#x27;</span> file 显示空行行号</span><br><span class="line">sed  -n  -e <span class="string">&#x27;/^$/p&#x27;</span> -e <span class="string">&#x27;/^$/=&#x27;</span> file</span><br><span class="line">sed<span class="string">&#x27;/root/a\superman&#x27;</span> /etc/passwd行后</span><br><span class="line">sed <span class="string">&#x27;/root/i\superman&#x27;</span> /etc/passwd 行前</span><br><span class="line">sed <span class="string">&#x27;/root/c\superman&#x27;</span> /etc/passwd 代替行</span><br><span class="line">sed <span class="string">&#x27;/^$/d&#x27;</span> file</span><br><span class="line">sed <span class="string">&#x27;1,10d&#x27;</span>   file</span><br><span class="line"><span class="built_in">nl</span> /etc/passwd | sed <span class="string">&#x27;2,5d&#x27;</span></span><br><span class="line"><span class="built_in">nl</span> /etc/passwd | sed <span class="string">&#x27;2a tea&#x27;</span></span><br><span class="line">sed <span class="string">&#x27;s/test/mytest/g&#x27;</span> example</span><br><span class="line">sed -n <span class="string">&#x27;s/root/&amp;superman/p&#x27;</span> /etc/passwd 单词后</span><br><span class="line">sed -n <span class="string">&#x27;s/root/superman&amp;/p&#x27;</span> /etc/passwd 单词前</span><br><span class="line">sed -e <span class="string">&#x27;s/dog/cat/&#x27;</span> -e <span class="string">&#x27;s/hi/lo/&#x27;</span> pets  </span><br><span class="line">sed -i.bak  <span class="string">&#x27;s/dog/cat/g&#x27;</span> pets</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取 IP 地址</span></span><br><span class="line">ifconfig eth0 |sed -nr <span class="string">&quot;2s/[^0-9]+([0-9.]+).*/\1/p&quot;</span></span><br><span class="line">ifconfig eth0 | sed -En <span class="string">&#x27;2s/^[^0-9]+([0-9.]&#123;7,15&#125;).*/\1/p&#x27;</span></span><br><span class="line">ifconfig eth0 | sed -rn <span class="string">&#x27;2s/^[^0-9]+([0-9.]+) .*$/\1/p&#x27;</span></span><br><span class="line">ifconfig eth0 | sed -n <span class="string">&#x27;2s/^.*inet //p&#x27;</span> | sed -n <span class="string">&#x27;s/netmask.*//p&#x27;</span></span><br><span class="line">ifconfig eth0 | sed -n <span class="string">&#x27;2s/^.*inet //;s/ netmask.*//p&#x27;</span></span><br><span class="line">ifconfig eth0 | sed -rn <span class="string">&#x27;2s/(.*inet )([0-9].*)(netmask.*)/\2/p&#x27;</span></span><br><span class="line">&gt;&gt;&gt; 10.0.0.8 </span><br><span class="line"></span><br><span class="line"><span class="comment"># 取基名和目录名</span></span><br><span class="line"><span class="comment">#取目录名</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/etc/sysconfig/network-scripts/&quot;</span> | sed -r <span class="string">&#x27;s#(^/.*/)([^/]+/?)#\1#&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> /etc/sysconfig/ | sed -rn <span class="string">&#x27;s#(.*)/([^/]+)/?#\1#p&#x27;</span></span><br><span class="line"><span class="comment">#取基名</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/etc/sysconfig/network-scripts/&quot;</span> |sed -r <span class="string">&#x27;s#(^/.*/)([^/]+/?)#\2#&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> /etc/sysconfig/ | sed -rn <span class="string">&#x27;s#(.*)/([^/]+)/?#\2#p&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取文件的前缀和后缀</span></span><br><span class="line">[root@centos8 data]<span class="comment">#echo a.b.c.gz |sed -En &#x27;s/(.*)\.([^.]+)$/\1/p&#x27;</span></span><br><span class="line">a.b.c</span><br><span class="line">[root@centos8 data]<span class="comment">#echo a.b.c.gz |sed -En &#x27;s/(.*)\.([^.]+)$/\2/p&#x27;</span></span><br><span class="line">gz</span><br><span class="line">[root@centos8 data]<span class="comment">#echo a.b.c.gz |grep -Eo &#x27;.*\.&#x27;</span></span><br><span class="line">a.b.c</span><br><span class="line">[root@centos8 data]<span class="comment">#echo a.b.c.gz |grep -Eo &#x27;[^.]+$&#x27;</span></span><br><span class="line">gz</span><br><span class="line">[root@centos8 ~]<span class="comment">#echo a.b.tar.gz | sed -rn &#x27;s@.*\.([^.]+)\.([^.]+)$@\1.\2@p&#x27;</span></span><br><span class="line">tar.gz</span><br><span class="line"></span><br><span class="line">范例：将非<span class="comment">#开头的行加#</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#sed -rn &quot;s/^[^#]/#&amp;/p&quot;   /etc/fstab</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#sed -rn &#x27;s/^[^#](.*)/#\1/p&#x27; /etc/fstab</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#sed -rn &#x27;/^#/!s@^@#@p&#x27; /etc/fstab </span></span><br><span class="line"></span><br><span class="line">范例：将<span class="comment">#开头的行删除#</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#sed -ri.bak &#x27;/^#/s/^#//&#x27; /etc/fstab</span></span><br><span class="line"></span><br><span class="line">范例：取分区利用率</span><br><span class="line">[root@centos8 ~]<span class="comment">#df | sed -nr &#x27;/^\/dev\/sd/s# .* ([0-9]+)%.*# \1#p&#x27;</span></span><br><span class="line">/dev/sda2 3</span><br><span class="line">/dev/sda5 1</span><br><span class="line">/dev/sda1 14</span><br><span class="line">[root@centos8 ~]<span class="comment">#df | sed -rn &#x27;/^\/dev\/sd/ s#([^[:space:]]+[[:space:]]+)&#123;4&#125;(.*)%.*#\2#p&#x27;</span></span><br><span class="line">3</span><br><span class="line">1</span><br><span class="line">19</span><br><span class="line">[root@centos8 ~]<span class="comment">#df | sed -rn &#x27;/^\/dev\/sd/ s#(\S+\s+)&#123;4&#125;(.*)%.*#\2#p&#x27;</span></span><br><span class="line">3</span><br><span class="line">1</span><br><span class="line">19</span><br><span class="line">范例：修改内核参数</span><br><span class="line">[root@centos8 ~]<span class="comment">#sed -nr &#x27;/^GRUB_CMDLINE_LINUX/s/&quot;$/ net.ifnames=0&quot;/p&#x27; /etc/default/grub</span></span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">&quot;crashkernel=auto resume=UUID=8363289d-138e-4e4a-abaf-6e028babc924 rhgb quiet net.ifnames=0&quot;</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#sed -rn &#x27;/^GRUB_CMDLINE_LINUX=/s@(.*)&quot;$@\1 net.ifnames=0&quot;@p&#x27; </span></span><br><span class="line">/etc/default/grub</span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">&quot;crashkernel=auto resume=UUID=a0efb2bb-8227-4317-a79d-0a70d515046c rhgb quiet net.ifnames=0&quot;</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#sed -rn &#x27;/^GRUB_CMDLINE_LINUX=/s@&quot;$@ net.ifnames=0&quot;@p&#x27; </span></span><br><span class="line">/etc/default/grub</span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">&quot;crashkernel=auto resume=UUID=a0efb2bb-8227-4317-a79d-0a70d515046c rhgb quiet net.ifnames=0 net.ifnames=0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改网卡名称</span></span><br><span class="line"><span class="comment">#centos7,8</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#sed -i &#x27;/GRUB_CMDLINE_LINUX=/s#quiet#&amp; net.ifnames=0#&#x27; /etc/default/grub</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#sed -ri &#x27;/^GRUB_CMDLINE_LINUX=/s@&quot;$@ net.ifnames=0&quot;@&#x27; /etc/default/grub</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#grub2-mkconfig -o /boot/grub2/grub.cfg </span></span><br><span class="line"><span class="comment">#ubuntu</span></span><br><span class="line">[root@ubuntu ~]<span class="comment">#grub-mkconfig -o /boot/grub/grub.cfg</span></span><br><span class="line">范例：查看配置文件</span><br><span class="line"><span class="comment">#过滤掉空行和#开头的行</span></span><br><span class="line">sed -r <span class="string">&#x27;/^(#|$)/d&#x27;</span> /etc/httpd/conf/httpd.conf</span><br><span class="line">sed -r <span class="string">&#x27;/^#|^$/d&#x27;</span> /etc/httpd/conf/httpd.conf </span><br><span class="line"><span class="comment">#可以排除行首后加多个空白符之后有#这种行</span></span><br><span class="line">sed -n <span class="string">&#x27;/^$/d;/^[[:space:]]*#/!p&#x27;</span> /etc/httpd/conf/httpd.conf</span><br><span class="line">sed -n  -e <span class="string">&#x27;/^$/d&#x27;</span> -e <span class="string">&#x27;/^[[:space:]]*#/!p&#x27;</span> /etc/httpd/conf/httpd.conf</span><br><span class="line"><span class="comment">#注意:以下前后顺序不同,执行效果不同</span></span><br><span class="line">sed -n <span class="string">&#x27;/^[[:space:]]*#/!p;/^$/d&#x27;</span> /etc/httpd/conf/httpd.conf</span><br><span class="line">sed -n -e <span class="string">&#x27;/^[[:space:]]*#/!p&#x27;</span> -e <span class="string">&#x27;/^$/d&#x27;</span> /etc/httpd/conf/httpd.conf</span><br><span class="line">范例：引用变量</span><br><span class="line">[root@centos8 ~]<span class="comment">#echo|sed &quot;s/^/$RANDOM.rmvb/&quot;</span></span><br><span class="line">5242.rmvb</span><br><span class="line">[root@centos8 ~]<span class="comment">#echo|sed &#x27;s/^/$RANDOM.rmvb/&#x27;</span></span><br><span class="line"><span class="variable">$RANDOM</span>.rmvb</span><br><span class="line">[root@centos8 ~]<span class="comment">#echo|sed &#x27;s/^/&#x27;$RANDOM&#x27;.rmvb/&#x27;</span></span><br><span class="line">13849.rmvb</span><br><span class="line">[root@centos8 ~]<span class="comment">#echo|sed &#x27;s/^/&#x27;&#x27;&#x27;$RANDOM&#x27;&#x27;&#x27;.rmvb/&#x27;</span></span><br><span class="line">28767.rmvb</span><br><span class="line">范例：修改配置文件</span><br><span class="line">[root@centos6 ~]<span class="comment">#sed   -e &#x27;/^#&lt;VirtualHost/,/^#&lt;\/VirtualHost&gt;/s@#@@&#x27; -e &#x27;/^#NameVirtualHost/s@#@@&#x27; /etc/httpd/conf/httpd.conf</span></span><br><span class="line"></span><br><span class="line">范例: 变量实现多点编辑配置文件</span><br><span class="line">[root@centos8 ~]<span class="comment">#port=8080</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#sed -ri.bak -e &#x27;s/^Listen 80/Listen &#x27;$port&#x27;/&#x27; -e &quot;/ServerName/cServerName `hostname`:$port&quot; /etc/httpd/conf/httpd.conf</span></span><br><span class="line"></span><br><span class="line">范例: 显示前10行</span><br><span class="line">[root@centos8 ~]<span class="comment">#seq 100 &gt; test.txt</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#sed 10q test.txt</span></span><br></pre></td></tr></table></figure><p>sed 中除了模式空间，还另外还支持保持空间（Hold Space）,利用此空间，可以将模式空间中的数据，临时保存至保持空间，从而后续接着处理，实现更为强大的功能。</p><p>常见的高级命令</p><ul><li><code>P</code>：打印模式空间开端至\n内容，并追加到默认输出之前</li><li><code>h</code>：把模式空间中的内容覆盖至保持空间中</li><li><code>H</code>：把模式空间中的内容追加至保持空间中</li><li><code>g</code>：从保持空间取出数据覆盖至模式空间</li><li><code>G</code>：从保持空间取出内容追加至模式空间</li><li><code>x</code>：把模式空间中的内容与保持空间中的内容进行互换</li><li><code>n</code>：读取匹配到的行的下一行覆盖至模式空间</li><li><code>N</code>：读取匹配到的行的下一行追加至模式空间</li><li><code>d</code>：删除模式空间中的行</li><li><code>D</code>：如果模式空间包含换行符，则删除直到第一个换行符的模式空间中的文本，并不会读取新的输入行，而使用合成的模式空间重新启动循环。如果模式空间不包含换行符，则会像发出d命令那样启动正常的新循环</li></ul><p>如：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;n;p&#x27;</span> FILE</span><br><span class="line"><span class="built_in">seq</span> 10 | sed <span class="string">&#x27;N;s/\n//&#x27;</span></span><br><span class="line">sed <span class="string">&#x27;1!G;h;$!d&#x27;</span> FILE</span><br><span class="line"><span class="built_in">seq</span> 10 | sed -n <span class="string">&#x27;/3/&#123;g;1!p;&#125;;h&#x27;</span>  <span class="comment">#前一行</span></span><br><span class="line"><span class="built_in">seq</span> 10 | sed -nr <span class="string">&#x27;/3/&#123;n;p&#125;&#x27;</span>      <span class="comment">#后一行</span></span><br><span class="line">sed  <span class="string">&#x27;N;D&#x27;</span>FILE</span><br><span class="line"><span class="built_in">seq</span> 10 |sed  <span class="string">&#x27;3h;9G;9!d&#x27;</span></span><br><span class="line">sed <span class="string">&#x27;$!N;$!D&#x27;</span> FILE</span><br><span class="line">sed <span class="string">&#x27;$!d&#x27;</span> FILE</span><br><span class="line">sed <span class="string">&#x27;G&#x27;</span> FILE</span><br><span class="line">sed <span class="string">&#x27;g&#x27;</span> FILE</span><br><span class="line">sed <span class="string">&#x27;/^$/d;G&#x27;</span> FILE</span><br><span class="line">sed <span class="string">&#x27;n;d&#x27;</span> FILE </span><br><span class="line">sed -n <span class="string">&#x27;1!G;h;$p&#x27;</span> FILE</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印偶数行</span></span><br><span class="line"><span class="built_in">seq</span> 10 | sed -n <span class="string">&#x27;n;p&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | sed -n <span class="string">&#x27;2~2p&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | sed <span class="string">&#x27;1~2d&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | sed -n <span class="string">&#x27;1~2!p&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h3><p>awk：Aho, Weinberger, Kernighan，报告生成器，格式化文本输出，GNU&#x2F;Linux 发布的 AWK 目前由自由软件基金会（FSF）进行开发和维护，通常也称它为 GNU AWK</p><p>有多种版本：</p><ul><li>AWK：原先来源于 AT &amp; T 实验室的的AWK</li><li>NAWK：New awk，AT &amp; T 实验室的AWK的升级版</li><li>GAWK：即GNU AWK。所有的GNU&#x2F;Linux发布版都自带GAWK，它与AWK和NAWK完全兼容</li></ul><p>gawk：模式扫描和处理语言，可以实现下面功能</p><ul><li>文本处理</li><li>输出格式化的文本报表</li><li>执行算数运算</li><li>执行字符串操作</li></ul><p>格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk [options]   &#x27;program&#x27; var=value   file...</span><br><span class="line">awk [options]   -f programfile    var=value file...</span><br></pre></td></tr></table></figure><p>说明：<br>program 通常是被放在单引号中，并可以由三种部分组成</p><ul><li>BEGIN 语句块</li><li>模式匹配的通用语句块</li><li>END 语句块</li></ul><h4 id="选项-9"><a href="#选项-9" class="headerlink" title="选项"></a>选项</h4><ul><li><code>-F 分隔符</code>：指明输入时用到的字段分隔符，默认的分隔符是若干个连续空白符</li><li><code>-v var=value</code>：变量赋值</li></ul><h4 id="Program-格式"><a href="#Program-格式" class="headerlink" title="Program 格式"></a>Program 格式</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pattern&#123;action statements;..&#125;</span><br></pre></td></tr></table></figure><ul><li><code>pattern</code>：决定动作语句何时触发及触发事件，比如：BEGIN,END,正则表达式等</li><li><code>action statements</code>：对数据进行处理，放在 {} 内指明，常见：print, printf</li></ul><p><strong>awk 工作过程</strong><br>第一步：执行BEGIN{action;… }语句块中的语句</p><p>第二步：从文件或标准输入(stdin)读取一行，然后执行pattern{ action;… }语句块，它逐行扫描文件，从第一行到最后一行重复这个过程，直到文件全部被读取完毕。</p><p>第三步：当读至输入流末尾时，执行END{action;…}语句块<br>BEGIN语句块在awk开始从输入流中读取行之前被执行，这是一个可选的语句块，比如变量初始化、打印输出表格的表头等语句通常可以写在BEGIN语句块中</p><p>END语句块在awk从输入流中读取完所有的行之后即被执行，比如打印所有行的分析结果这类信息汇总都是在END语句块中完成，它也是一个可选语句块</p><p>pattern语句块中的通用命令是最重要的部分，也是可选的。如果没有提供pattern语句块，则默认执行{ print }，即打印每一个读取到的行，awk读取的每一行都会执行该语句块</p><p><strong>分割符、域和记录</strong></p><ul><li>由分隔符分隔的字段（列column,域field）标记$1,$2…$n称为域标识，$0为所有域，注意：和shell中变量$符含义不同</li><li>文件的每一行称为记录record</li><li>如果省略action，则默认执行 print $0 的操作</li></ul><p><strong>常用的 action 分类</strong></p><ul><li>output statements：print,printf</li><li>Expressions：算术，比较表达式等</li><li>Compound statements：组合语句</li><li>Control statements：if, while等</li><li>input statements</li></ul><p><strong>awk 控制语句</strong></p><ul><li>{ statements;… } 组合语句</li><li>if(condition) {statements;…}</li><li>if(condition) {statements;…} else {statements;…}</li><li>while(conditon) {statments;…}</li><li>do {statements;…} while(condition)</li><li>for(expr1;expr2;expr3) {statements;…}</li><li>break</li><li>continue</li><li>exit</li></ul><h4 id="动作-print"><a href="#动作-print" class="headerlink" title="动作 print"></a>动作 print</h4><p>格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print item1, item2, ...</span><br></pre></td></tr></table></figure><p>说明：</p><ul><li>逗号分隔符</li><li>输出item可以字符串，也可是数值；当前记录的字段、变量或awk的表达式</li><li>如省略item，相当于print $0</li><li>固定字符符需要用“ ” 引起来，而变量和数字不需要</li></ul><p><strong>范例</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;&#123;print &quot;hello,awk&quot;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | awk <span class="string">&#x27;&#123;print &quot;hello,awk&quot;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 3 | awk <span class="string">&#x27;&#123;print 2*3&#125;&#x27;</span></span><br><span class="line">awk -F: <span class="string">&#x27;&#123;print &quot;wang&quot;&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">&#x27;&#123;print&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">&#x27;&#123;print $0&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">&#x27;&#123;print $1,$3&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">&#x27;&#123;print $1&quot;\t&quot;$3&#125;&#x27;</span> /etc/passwd</span><br><span class="line">grep <span class="string">&quot;^UUID&quot;</span> /etc/fstab |awk &#123;<span class="string">&#x27;print $2,$3&#x27;</span>&#125;</span><br><span class="line">&gt;&gt;&gt; / xfs</span><br><span class="line">&gt;&gt;&gt; /boot ext4</span><br><span class="line">&gt;&gt;&gt; /data xfs</span><br><span class="line">&gt;&gt;&gt; swap swap</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取出网站访问量最大的前3个IP</span></span><br><span class="line">awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> nginx.access.log-20200428|<span class="built_in">sort</span> | <span class="built_in">uniq</span> -c |<span class="built_in">sort</span> -nr|<span class="built_in">head</span> -3</span><br><span class="line">&gt;&gt;&gt;   5498 122.51.38.20</span><br><span class="line">&gt;&gt;&gt;   2161 117.157.173.214</span><br><span class="line">&gt;&gt;&gt;    953 211.159.177.120</span><br><span class="line">awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> access_log |<span class="built_in">sort</span> |<span class="built_in">uniq</span> -c|<span class="built_in">sort</span> -nr|<span class="built_in">head</span> -3</span><br><span class="line">&gt;&gt;&gt;   4870 172.20.116.228</span><br><span class="line">&gt;&gt;&gt;   3429 172.20.116.208</span><br><span class="line">&gt;&gt;&gt;   2834 172.20.0.222</span><br><span class="line"><span class="comment"># 取出分区利用率</span></span><br><span class="line"><span class="built_in">df</span> | awk <span class="string">&#x27;&#123;print $1,$5&#125;&#x27;</span> </span><br><span class="line"><span class="comment">#使用扩展的正则表达式</span></span><br><span class="line"><span class="built_in">df</span> | awk -F<span class="string">&quot;[[:space:]]+|%&quot;</span> <span class="string">&#x27;&#123;print $5&#125;&#x27;</span></span><br><span class="line"><span class="built_in">df</span> | awk -F<span class="string">&quot;[ %]+&quot;</span> <span class="string">&#x27;&#123;print $5&#125;&#x27;</span></span><br><span class="line"><span class="built_in">df</span> | awk -F<span class="string">&#x27;[[:space:]]+|%&#x27;</span> <span class="string">&#x27;&#123;print $1,$5&#125;&#x27;</span>  </span><br><span class="line"><span class="built_in">df</span> | grep <span class="string">&quot;^/dev/sd&quot;</span> | awk -F<span class="string">&quot;[[:space:]]+|%&quot;</span> <span class="string">&#x27;&#123;print $5&#125;&#x27;</span></span><br><span class="line"><span class="built_in">df</span> | grep <span class="string">&#x27;^/dev/sd&#x27;</span>| awk -F<span class="string">&#x27;[[:space:]]+|%&#x27;</span> <span class="string">&#x27;&#123;print $1,$5&#125;&#x27;</span> </span><br><span class="line"><span class="built_in">df</span> | awk -F<span class="string">&quot;[[:space:]]+|%&quot;</span> <span class="string">&#x27;/^\/dev\/sd/&#123;print $5&#125;&#x27;</span></span><br><span class="line"><span class="built_in">df</span> | awk -F<span class="string">&#x27;[[:space:]]+|%&#x27;</span> <span class="string">&#x27;/^\/dev\/sd/&#123;print $1,$5&#125;&#x27;</span>  </span><br><span class="line"><span class="built_in">df</span>|awk -F<span class="string">&#x27; +|%&#x27;</span> <span class="string">&#x27;/^\/dev\/sd/&#123;print $1,$5&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取nginx的访问日志的中IP和时间</span></span><br><span class="line"><span class="built_in">head</span> -n 3 /apps/nginx/logs/nginx.access.log</span><br><span class="line">awk -F<span class="string">&#x27;[[ ]&#x27;</span> <span class="string">&#x27;&#123;print $1,$5&#125;&#x27;</span> /apps/nginx/logs/nginx.access.log|<span class="built_in">head</span> -3</span><br><span class="line">hostname -I | <span class="built_in">cat</span> -A</span><br><span class="line">ifconfig eth0|sed -n <span class="string">&#x27;2p&#x27;</span> |awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>|<span class="built_in">cat</span> -A</span><br><span class="line">ifconfig eth0 | awk <span class="string">&#x27;/netmask/&#123;print $2&#125;&#x27;</span></span><br><span class="line">ifconfig eth0 |awk -F <span class="string">&quot; +|:&quot;</span> <span class="string">&#x27;/Mask/&#123;print $4&#125;&#x27;</span></span><br><span class="line">ip a show eth0 |awk -F<span class="string">&#x27; +|\/&#x27;</span> <span class="string">&#x27;/\&lt;inet\&gt;/&#123;print $3&#125;&#x27;</span> 2&gt; /dev/null</span><br><span class="line">ifconfig eth0| sed -rn <span class="string">&#x27;2s/^[^0-9]+([0-9.]+) .*$/\1/p&#x27;</span></span><br><span class="line">ifconfig eth0| sed -rn <span class="string">&#x27;2s/^[^0-9]+([0-9.]+) .*$/\1/p&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件host_list.log 如下格式，请提取”.magedu.com”前面的主机名部分并写入到回到该文件中</span></span><br><span class="line"><span class="built_in">cat</span> host_list.log</span><br><span class="line">&gt;&gt;&gt; 1 www.magedu.com</span><br><span class="line">&gt;&gt;&gt; 2 blog.magedu.com</span><br><span class="line">&gt;&gt;&gt; 3 study.magedu.com</span><br><span class="line">awk -F<span class="string">&quot;[ .]&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> host_list.log</span><br><span class="line">&gt;&gt;&gt; www</span><br><span class="line">&gt;&gt;&gt; blog</span><br><span class="line">&gt;&gt;&gt; study</span><br><span class="line">awk -F<span class="string">&quot;[ .]&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> host_list.log &gt;&gt; host_list.log </span><br><span class="line"><span class="built_in">cat</span> host_list.log</span><br><span class="line">&gt;&gt;&gt; 1 www.magedu.com</span><br><span class="line">&gt;&gt;&gt; 2 blog.magedu.com</span><br><span class="line">&gt;&gt;&gt; 3 study.magedu.com</span><br><span class="line">&gt;&gt;&gt; www</span><br><span class="line">&gt;&gt;&gt; blog</span><br><span class="line">&gt;&gt;&gt; study</span><br></pre></td></tr></table></figure><h4 id="awk-变量"><a href="#awk-变量" class="headerlink" title="awk 变量"></a>awk 变量</h4><p>awk 中的变量分为：内置和自定义变量</p><p><strong>常见的内置变量</strong></p><ul><li><code>FS</code>：输入字段分隔符，默认为空白字符,功能相当于 -F</li><li><code>OFS</code>：输出字段分隔符，默认为空白字符</li><li><code>RS</code>：输入记录 record 分隔符，指定输入时的换行符</li><li><code>ORS</code>：输出记录分隔符，输出时用指定符号代替换行符</li><li><code>NF</code>：字段数量</li><li><code>NR</code>：记录的编号</li><li><code>FNR</code>：各文件分别计数，记录的编号</li><li><code>FILENAME</code>：当前文件名</li><li><code>ARGC</code>：命令行参数的个数</li><li><code>ARGV</code>：数组，保存的是命令行所给定的各参数，每一个参数：<code>ARGV[0]</code>，……</li></ul><p>如：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">awk -v FS=<span class="string">&#x27;:&#x27;</span>  <span class="string">&#x27;&#123;print $1,FS,$3&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -v FS=<span class="string">&quot;:&quot;</span> <span class="string">&#x27;&#123;print $1FS$3&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk –F:   <span class="string">&#x27;&#123;print $1,$3,$7&#125;&#x27;</span>   /etc/passwd </span><br><span class="line">S=:;awk -v FS=<span class="variable">$S</span> <span class="string">&#x27;&#123;print $1FS$3&#125;&#x27;</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">awk -v FS=<span class="string">&quot;:&quot;</span> <span class="string">&#x27;&#123;print $1FS$3&#125;&#x27;</span> /etc/passwd |<span class="built_in">head</span> -n3</span><br><span class="line">S=:;awk -F<span class="variable">$S</span>   <span class="string">&#x27;&#123;print $1,$3&#125;&#x27;</span> /etc/passwd|<span class="built_in">head</span> -n3</span><br><span class="line"></span><br><span class="line"><span class="comment">#-F 和 FS变量功能一样，同时使用会冲突</span></span><br><span class="line">awk -v FS=<span class="string">&quot;:&quot;</span> -F<span class="string">&quot;;&quot;</span> <span class="string">&#x27;&#123;print $1FS$3&#125;&#x27;</span> /etc/passwd |<span class="built_in">head</span> -n3</span><br><span class="line">awk -F<span class="string">&quot;;&quot;</span> -v FS=<span class="string">&quot;:&quot;</span> <span class="string">&#x27;&#123;print $1FS$3&#125;&#x27;</span> /etc/passwd |<span class="built_in">head</span> -n3</span><br><span class="line"><span class="comment">#-F 和 FS变量功能一样，同时使用会 -F 优先级高</span></span><br><span class="line">awk -v FS=<span class="string">&quot;:&quot;</span> -F<span class="string">&quot;;&quot;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> /etc/passwd |<span class="built_in">head</span> -n3</span><br><span class="line">awk -v FS=<span class="string">&quot;;&quot;</span> -F<span class="string">&quot;:&quot;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> /etc/passwd |<span class="built_in">head</span> -n3</span><br><span class="line"></span><br><span class="line">awk -v FS=<span class="string">&#x27;:&#x27;</span>   <span class="string">&#x27;&#123;print $1,$3,$7&#125;&#x27;</span>   /etc/passwd|<span class="built_in">head</span> -n1</span><br><span class="line">awk -v FS=<span class="string">&#x27;:&#x27;</span> -v OFS=<span class="string">&#x27;:&#x27;</span> <span class="string">&#x27;&#123;print $1,$3,$7&#125;&#x27;</span>   /etc/passwd|<span class="built_in">head</span> -n1</span><br><span class="line"></span><br><span class="line">awk -v RS=<span class="string">&#x27; &#x27;</span> <span class="string">&#x27;&#123;print &#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -v RS=<span class="string">&#x27; &#x27;</span> -v ORS=<span class="string">&#x27;###&#x27;</span>  <span class="string">&#x27;&#123;print $0&#125;&#x27;</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment">#引用变量时，变量前不需加$</span></span><br><span class="line">awk -F：<span class="string">&#x27;&#123;print NF&#125;&#x27;</span> /etc/fstab </span><br><span class="line">awk -F：<span class="string">&#x27;&#123;print $(NF-1)&#125;&#x27;</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="built_in">ls</span> /misc/cd/BaseOS/Packages/*.rpm |awk -F<span class="string">&quot;.&quot;</span> <span class="string">&#x27;&#123;print $(NF-1)&#125;&#x27;</span>|<span class="built_in">sort</span> |<span class="built_in">uniq</span> -c</span><br><span class="line">&gt;&gt;&gt;    389 i686</span><br><span class="line">&gt;&gt;&gt;    208 noarch</span><br><span class="line">&gt;&gt;&gt;   1060 x86_64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 面试题：接数最多的前3个IP</span></span><br><span class="line">awk -F<span class="string">&quot; +|:&quot;</span> <span class="string">&#x27;&#123;print $(NF-2)&#125;&#x27;</span> ss.log |<span class="built_in">sort</span> |<span class="built_in">uniq</span> -c|<span class="built_in">sort</span> - nr|<span class="built_in">head</span> -n3</span><br><span class="line">awk -F<span class="string">&quot; +|:&quot;</span> <span class="string">&#x27;/^ESTAB/&#123;print $(NF-2)&#125;&#x27;</span> ss.log |<span class="built_in">sort</span> |<span class="built_in">uniq</span> - c|<span class="built_in">sort</span> -nr|<span class="built_in">head</span> -n3</span><br><span class="line">&gt;&gt;&gt;     12 223.88.255.148</span><br><span class="line">&gt;&gt;&gt;     11 119.250.197.118</span><br><span class="line">&gt;&gt;&gt;     10 183.202.63.36</span><br><span class="line"></span><br><span class="line">ss -nt |grep <span class="string">&quot;^ESTAB&quot;</span> | awk -F<span class="string">&quot;[[:space:]]+|:&quot;</span> <span class="string">&#x27;&#123;print $(NF-2)&#125;&#x27;</span></span><br><span class="line">ss -nt |awk -F<span class="string">&quot;[[:space:]]+|:&quot;</span> <span class="string">&#x27;/^ESTAB/&#123;print $(NF-2)&#125;&#x27;</span></span><br><span class="line">ss -nt|awk -F: <span class="string">&#x27;&#123;print $(NF-1)&#125;&#x27;</span> |awk <span class="string">&#x27;/^[0-9]/&#123;print $NF&#125;&#x27;</span>| <span class="built_in">sort</span> |<span class="built_in">uniq</span> -c |<span class="built_in">head</span> -n 3</span><br><span class="line">awk -F<span class="string">&#x27; +|:&#x27;</span> <span class="string">&#x27;NR!=1&#123;print $(NF-2)&#125;&#x27;</span> ss.log|<span class="built_in">sort</span> |<span class="built_in">uniq</span> -c</span><br><span class="line">&gt;&gt;&gt;      1 100.100.30.25</span><br><span class="line">&gt;&gt;&gt;     86 39.164.140.13</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每十分钟检查将连接数超过100个以上的IP放入黑名单拒绝访问</span></span><br><span class="line"><span class="built_in">cat</span> deny_dos.sh</span><br><span class="line">&gt;&gt;&gt; LINK=100</span><br><span class="line">&gt;&gt;&gt; <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">&gt;&gt;&gt;   ss -nt | awk -F<span class="string">&quot;[[:space:]]+|:&quot;</span> <span class="string">&#x27;/^ESTAB/&#123;print $(NF-2)&#125;&#x27;</span>|<span class="built_in">sort</span> |<span class="built_in">uniq</span> - c|<span class="keyword">while</span> <span class="built_in">read</span> count ip;<span class="keyword">do</span> </span><br><span class="line">&gt;&gt;&gt;   <span class="keyword">if</span> [ <span class="variable">$count</span> -gt <span class="variable">$LINK</span> ];<span class="keyword">then</span></span><br><span class="line">&gt;&gt;&gt;     iptables -A INPUT -s <span class="variable">$ip</span> -j REJECT</span><br><span class="line">&gt;&gt;&gt;   <span class="keyword">fi</span></span><br><span class="line">&gt;&gt;&gt;   <span class="keyword">done</span></span><br><span class="line">&gt;&gt;&gt; <span class="keyword">done</span></span><br><span class="line"><span class="built_in">chmod</span> +x /root/deny_dos.sh &amp;&amp; crontab -e </span><br><span class="line">crontab -l </span><br><span class="line">&gt;&gt;&gt; */10 * * * *   /root/deny_dos.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> deny_dos.sh</span><br><span class="line">&gt;&gt;&gt; IPLIST=`awk -F<span class="string">&quot; +|:&quot;</span> <span class="string">&#x27;/^ESTAB/&#123;print $(NF-2)&#125;&#x27;</span> ss.log |<span class="built_in">sort</span> |<span class="built_in">uniq</span> -c|<span class="built_in">sort</span> - nr|<span class="built_in">head</span> -3|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">&gt;&gt;&gt; <span class="keyword">for</span> ip <span class="keyword">in</span> <span class="variable">$IPLIST</span>;<span class="keyword">do</span></span><br><span class="line">&gt;&gt;&gt;    iptables -A INPUT -s  <span class="variable">$ip</span> -j REJECT</span><br><span class="line">&gt;&gt;&gt; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;&#123;print NR,$0&#125;&#x27;</span> /etc/issue /etc/centos-release</span><br><span class="line">&gt;&gt;&gt; 1 \S</span><br><span class="line">&gt;&gt;&gt; 2 Kernel \r on an \m</span><br><span class="line">&gt;&gt;&gt; 3</span><br><span class="line">&gt;&gt;&gt; 4 CentOS Linux release 8.1.1911 (Core) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 范例：取ifconfig输出结果中的IP地址</span></span><br><span class="line">ifconfig eth0 | awk <span class="string">&#x27;/netmask/&#123;print $2&#125;&#x27;</span></span><br><span class="line">ifconfig eth0 | awk <span class="string">&#x27;NR==2&#123;print $2&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">awk -F: <span class="string">&#x27;&#123;print NR&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">&#x27;END&#123;print NR&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">&#x27;BEGIN&#123;print NR&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk <span class="string">&#x27;&#123;print FNR&#125;&#x27;</span> /etc/fstab /etc/inittab</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;&#123;print FNR,$0&#125;&#x27;</span> /etc/issue /etc/redhat-release </span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;&#123;print FILENAME&#125;&#x27;</span> /etc/fstab</span><br><span class="line">awk <span class="string">&#x27;&#123;print FNR,FILENAME,$0&#125;&#x27;</span> /etc/issue /etc/redhat-release </span><br><span class="line">&gt;&gt;&gt; 1 /etc/issue \S</span><br><span class="line">&gt;&gt;&gt; 2 /etc/issue Kernel \r on an \m</span><br><span class="line">&gt;&gt;&gt; 3 /etc/issue </span><br><span class="line">&gt;&gt;&gt; 1 /etc/redhat-release CentOS Linux release 8.0.1905 (Core)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;&#123;print ARGC&#125;&#x27;</span> /etc/issue /etc/redhat-release </span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;print ARGC&#125;&#x27;</span> /etc/issue /etc/redhat-release </span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;print ARGV[0]&#125;&#x27;</span> /etc/issue /etc/redhat-release </span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;print ARGV[1]&#125;&#x27;</span> /etc/issue /etc/redhat-release </span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;print ARGV[2]&#125;&#x27;</span> /etc/issue /etc/redhat-release /etc/redhat-release</span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;print ARGV[3]&#125;&#x27;</span> /etc/issue /etc/redhat-release </span><br></pre></td></tr></table></figure><h4 id="自定义变量"><a href="#自定义变量" class="headerlink" title="自定义变量"></a>自定义变量</h4><p>自定义变量是区分字符大小写的,使用下面方式进行赋值</p><ul><li>-v var&#x3D;value</li><li>在program中直接定义</li></ul><p>范例:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">awk -v test1=test2=<span class="string">&quot;hello,gawk&quot;</span> <span class="string">&#x27;BEGIN&#123;print test1,test2&#125;&#x27;</span>   </span><br><span class="line">awk -v test1=test2=<span class="string">&quot;hello1,gawk&quot;</span> <span class="string">&#x27;BEGIN&#123;test1=test2=&quot;hello2,gawk&quot;;print test1,test2&#125;&#x27;</span>   </span><br><span class="line"></span><br><span class="line">awk  -v <span class="built_in">test</span>=<span class="string">&#x27;hello gawk&#x27;</span> <span class="string">&#x27;&#123;print test&#125;&#x27;</span> /etc/fstab </span><br><span class="line">awk  -v <span class="built_in">test</span>=<span class="string">&#x27;hello gawk&#x27;</span> <span class="string">&#x27;BEGIN&#123;print test&#125;&#x27;</span></span><br><span class="line">awk  <span class="string">&#x27;BEGIN&#123;test=&quot;hello,gawk&quot;;print test&#125;&#x27;</span></span><br><span class="line">awk  -F: <span class="string">&#x27;&#123;sex=&quot;male&quot;;print $1,sex,age;age=18&#125;&#x27;</span> /etc/passwd</span><br><span class="line"><span class="built_in">cat</span> awkscript</span><br><span class="line">&gt;&gt;&gt; &#123;<span class="built_in">print</span> script,<span class="variable">$1</span>,<span class="variable">$2</span>&#125;</span><br><span class="line">awk  -F: -f awkscript script=<span class="string">&quot;awk&quot;</span> /etc/passwd</span><br></pre></td></tr></table></figure><h4 id="printf"><a href="#printf" class="headerlink" title="printf"></a>printf</h4><p>printf 可以实现格式化输出</p><p>格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">printf “FORMAT”, item1, item2, ...</span><br></pre></td></tr></table></figure><p><strong>说明</strong>：</p><ul><li>必须指定FORMAT</li><li>不会自动换行，需要显式给出换行控制符 \n</li><li>FORMAT中需要分别为后面每个item指定格式符</li></ul><p>格式符：与item一一对应</p><ul><li><code>%s</code>：显示字符串</li><li><code>%d, %i</code>：显示十进制整数</li><li><code>%f</code>：显示为浮点数</li><li><code>%e, %E</code>：显示科学计数法数值</li><li><code>%c</code>：显示字符的ASCII码</li><li><code>%g, %G</code>：以科学计数法或浮点形式显示数值</li><li><code>%u</code>：无符号整数</li><li><code>%%</code>：显示%自身</li></ul><p>修饰符</p><ul><li><code>#[.#]</code>第一个数字控制显示的宽度；第二个#表示小数点后精度，如：%3.1f</li><li><code>-</code>左对齐（默认右对齐） 如：%-15s</li><li><code>+</code> 显示数值的正负符号 如：%+d</li></ul><p>范例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">awk -F:   <span class="string">&#x27;&#123;printf &quot;%s&quot;,$1&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F:   <span class="string">&#x27;&#123;printf &quot;%s\n&quot;,$1&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F:   <span class="string">&#x27;&#123;printf &quot;%20s\n&quot;,$1&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F:   <span class="string">&#x27;&#123;printf &quot;%-20s\n&quot;,$1&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F:   <span class="string">&#x27;&#123;printf &quot;%-20s %10d\n&quot;,$1,$3&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F:   <span class="string">&#x27;&#123;printf &quot;Username: %s\n&quot;,$1&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F:   <span class="string">&#x27;&#123;printf “Username: %sUID:%d\n&quot;,$1,$3&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F:   <span class="string">&#x27;&#123;printf &quot;Username: %25sUID:%d\n&quot;,$1,$3&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F:   <span class="string">&#x27;&#123;printf &quot;Username: %-25sUID:%d\n&quot;,$1,$3&#125;&#x27;</span> /etc/passwd</span><br></pre></td></tr></table></figure><h4 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h4><p>算术操作符：</p><ul><li>x+y, x-y, x*y, x&#x2F;y, x^y, x%y</li><li>-x：转换为负数</li><li>+x：将字符串转换为数值</li></ul><p>字符串操作符：没有符号的操作符，字符串连接</p><p>赋值操作符：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">=, +=, -=, *=, /=, %=, ^=，++, --</span><br></pre></td></tr></table></figure><p>比较操作符：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">==, !=, &gt;, &gt;=, &lt;, &lt;=</span><br></pre></td></tr></table></figure><p>模式匹配符：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~ 左边是否和右边匹配，包含关系</span><br><span class="line">!~ 是否不匹配</span><br></pre></td></tr></table></figure><p>逻辑操作符：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">与：&amp;&amp;，并且关系</span><br><span class="line">或：||，或者关系</span><br><span class="line">非：!，取反</span><br></pre></td></tr></table></figure><p>条件表达式（三目表达式）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selector?if-true-expression:if-false-expression</span><br></pre></td></tr></table></figure><p>范例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;BEGIN&#123;i=0;print i++,i&#125;&#x27;</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;i=0;print ++i,i&#125;&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | awk <span class="string">&#x27;n++&#x27;</span></span><br><span class="line">awk -v n=0 <span class="string">&#x27;!n++&#x27;</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">awk -v n=0 <span class="string">&#x27;!n++&#123;print n&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -v n=1 <span class="string">&#x27;!n++&#123;print n&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -v n=0 <span class="string">&#x27;!++n&#123;print n&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -v n=0 <span class="string">&#x27;!++n&#x27;</span> /etc/passwd</span><br><span class="line">awk -v n=-1 <span class="string">&#x27;!++n&#x27;</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;NR==2&#x27;</span> /etc/issue</span><br><span class="line">awk -F: <span class="string">&#x27;$3&gt;=1000&#x27;</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取奇，偶数行</span></span><br><span class="line"><span class="built_in">seq</span> 10 | awk <span class="string">&#x27;NR%2==0&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | awk <span class="string">&#x27;NR%2==1&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | awk <span class="string">&#x27;NR%2!=0&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">awk -F: <span class="string">&#x27;$0 ~ /root/&#123;print $1&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">&#x27;$0 ~ &quot;^root&quot;&#123;print $1&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk <span class="string">&#x27;$0 !~ /root/&#x27;</span>   /etc/passwd</span><br><span class="line">awk <span class="string">&#x27;/root/&#x27;</span>   /etc/passwd</span><br><span class="line">awk -F: <span class="string">&#x27;/r/&#x27;</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">&#x27;$3==0&#x27;</span>     /etc/passwd</span><br><span class="line"><span class="built_in">df</span> | awk -F<span class="string">&quot;[[:space:]]+|%&quot;</span> <span class="string">&#x27;$0 ~ /^\/dev\/sd/&#123;print $5&#125;&#x27;</span></span><br><span class="line">ifconfig eth0 | awk <span class="string">&#x27;NR==2&#123;print $2&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ！取反</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;print i&#125;&#x27;</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;print !i&#125;&#x27;</span></span><br><span class="line">awk -v i=10 <span class="string">&#x27;BEGIN&#123;print !i&#125;&#x27;</span></span><br><span class="line">awk -v i=-3 <span class="string">&#x27;BEGIN&#123;print !i&#125;&#x27;</span></span><br><span class="line">awk -v i=0 <span class="string">&#x27;BEGIN&#123;print !i&#125;&#x27;</span></span><br><span class="line">awk -v i=abc <span class="string">&#x27;BEGIN&#123;print !i&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">awk -v i=<span class="string">&#x27;&#x27;</span> <span class="string">&#x27;BEGIN&#123;print !i&#125;&#x27;</span></span><br><span class="line">awk -F:   <span class="string">&#x27;$3&gt;=0 &amp;&amp; $3&lt;=1000 &#123;print $1,$3&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F:   <span class="string">&#x27;$3==0 || $3&gt;=1000 &#123;print $1,$3&#125;&#x27;</span> /etc/passwd </span><br><span class="line">awk -F:   <span class="string">&#x27;!($3==0) &#123;print $1,$3&#125;&#x27;</span>     /etc/passwd</span><br><span class="line">awk -F:   <span class="string">&#x27;!($3&gt;=500) &#123;print $1,$3&#125;&#x27;</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">awk -F: <span class="string">&#x27;&#123;$3&gt;=1000?usertype=&quot;Common User&quot;:usertype=&quot;SysUser&quot;;printf &quot;%-20s:%12s\n&quot;,$1,usertype&#125;&#x27;</span>   /etc/passwd</span><br><span class="line"><span class="built_in">df</span> | awk -F<span class="string">&quot;[ %]+&quot;</span> <span class="string">&#x27;/^\/dev\/sd/&#123;$(NF-1)&gt;10?  disk=&quot;full&quot;:disk=&quot;OK&quot;;print $(NF-1),disk&#125;&#x27;</span></span><br><span class="line">3 OK</span><br><span class="line">1 OK</span><br><span class="line">13 full</span><br></pre></td></tr></table></figure><h4 id="模式PATTERN"><a href="#模式PATTERN" class="headerlink" title="模式PATTERN"></a>模式PATTERN</h4><p>PATTERN:根据pattern条件，过滤匹配的行，再做处理</p><ul><li>如果未指定：空模式，匹配每一行</li><li>&#x2F;regular expression&#x2F;：仅处理能够模式匹配到的行，需要用&#x2F; &#x2F;括起来</li><li>relational expression: 关系表达式，结果为“真”才会被处理<br>真：结果为非0值，非空字符串<br>假：结果为空字符串或0值</li><li>line ranges：行范围<br>不支持直接用行号，但可以使用变量NR间接指定行号<br>&#x2F;pat1&#x2F;,&#x2F;pat2&#x2F; 不支持直接给出数字格式</li><li>BEGIN&#x2F;END模式<br>BEGIN{}：仅在开始处理文件中的文本之前执行一次<br>END{}：仅在文本处理完成之后执行一次</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">awk -F: <span class="string">&#x27;&#123;print $1,$3&#125;&#x27;</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">awk   <span class="string">&#x27;/^UUID/&#123;print $1&#125;&#x27;</span>     /etc/fstab</span><br><span class="line">awk   <span class="string">&#x27;!/^UUID/&#123;print $1&#125;&#x27;</span>   /etc/fstab</span><br><span class="line"><span class="built_in">df</span> | awk <span class="string">&#x27;/^\/dev\/sd/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">seq</span> 10 | awk <span class="string">&#x27;1&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | awk <span class="string">&#x27;0&#x27;</span> </span><br><span class="line"><span class="built_in">seq</span> 10 | awk <span class="string">&#x27;&quot;false&quot;&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | awk <span class="string">&#x27;&quot;&quot;&#x27;</span> </span><br><span class="line"><span class="built_in">seq</span> 10 | awk <span class="string">&#x27;&quot;0&quot;&#x27;</span> </span><br><span class="line"><span class="built_in">seq</span> 10 | awk <span class="string">&#x27;true&#x27;</span> </span><br><span class="line"><span class="built_in">seq</span> 10 | awk <span class="string">&#x27;false&#x27;</span> </span><br><span class="line"><span class="built_in">seq</span> 10 | awk <span class="string">&#x27;wang&#x27;</span> </span><br><span class="line"><span class="built_in">seq</span> 10 | awk <span class="string">&#x27;magedu&#x27;</span> </span><br><span class="line"><span class="built_in">seq</span> 10 | awk <span class="string">&#x27;0&#x27;</span> </span><br><span class="line"><span class="built_in">seq</span> 10 | awk <span class="string">&#x27;&quot; &quot;&#x27;</span> </span><br><span class="line"><span class="built_in">seq</span> 10 | awk <span class="string">&#x27;magedu&#x27;</span> </span><br><span class="line"><span class="built_in">seq</span> 10 | awk -v magedu=0 <span class="string">&#x27;magedu&#x27;</span> </span><br><span class="line"><span class="built_in">seq</span> 10 | awk -v magedu=<span class="string">&quot;&quot;</span> <span class="string">&#x27;magedu&#x27;</span> </span><br><span class="line"><span class="built_in">seq</span> 10 | awk -v magedu=<span class="string">&quot;0&quot;</span> <span class="string">&#x27;magedu&#x27;</span> </span><br><span class="line"><span class="built_in">seq</span> 10 | awk -v magedu=<span class="string">&quot;abc&quot;</span> <span class="string">&#x27;magedu&#x27;</span> </span><br><span class="line">awk <span class="string">&#x27;1&#x27;</span> /etc/passwd</span><br><span class="line">awk <span class="string">&#x27;!1&#x27;</span> /etc/passwd</span><br><span class="line">awk <span class="string">&#x27;!0&#x27;</span> /etc/passwd</span><br><span class="line">awk <span class="string">&#x27;1&#x27;</span> /etc/issue</span><br><span class="line">awk <span class="string">&#x27;0&#x27;</span> /etc/issue</span><br><span class="line">awk <span class="string">&#x27;&quot;magedu&quot;&#x27;</span> /etc/issue</span><br><span class="line">awk <span class="string">&#x27;&quot;&quot;&#x27;</span> /etc/issue</span><br><span class="line">awk <span class="string">&#x27;magedu&#x27;</span> /etc/issue</span><br><span class="line">awk <span class="string">&#x27;magedu&#x27;</span> /etc/issue</span><br><span class="line">awk -v magedu=wang <span class="string">&#x27;magedu&#x27;</span> /etc/issue</span><br><span class="line">awk -v magedu=<span class="string">&quot;&quot;</span> <span class="string">&#x27;magedu&#x27;</span> /etc/issue</span><br><span class="line">awk -v magedu=<span class="string">&quot;0&quot;</span> <span class="string">&#x27;magedu&#x27;</span> /etc/issue</span><br><span class="line">awk -v magedu=0 <span class="string">&#x27;magedu&#x27;</span> /etc/issue</span><br><span class="line">awk <span class="string">&#x27;&quot;0&quot;&#x27;</span> /etc/issue</span><br><span class="line">awk <span class="string">&#x27;0&#x27;</span> /etc/issue</span><br><span class="line"><span class="built_in">seq</span> 10 | awk   <span class="string">&#x27;i=0&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | awk   <span class="string">&#x27;i=1&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | awk   <span class="string">&#x27;i=!i&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | awk   <span class="string">&#x27;&#123;i=!i;print i&#125;&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | awk   <span class="string">&#x27;!(i=!i)&#x27;</span>              </span><br><span class="line"><span class="built_in">seq</span> 10 | awk  -v  i=1 <span class="string">&#x27;i=!i&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | awk   <span class="string">&#x27;i=0&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | awk   <span class="string">&#x27;i=1&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | awk   <span class="string">&#x27;i=1&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | awk   <span class="string">&#x27;i=0&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | awk   <span class="string">&#x27;i=!i&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | awk   <span class="string">&#x27;!(i=!i)&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | awk -v i=1 <span class="string">&#x27;i=!i&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | awk -v i=0 <span class="string">&#x27;i=!i&#x27;</span></span><br><span class="line"><span class="built_in">seq</span> 10 | awk   <span class="string">&#x27;&#123;i=!i;print i&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">awk  -F:  <span class="string">&#x27;i=1;j=1&#123;print i,j&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk  -F: <span class="string">&#x27;$3&gt;=1000&#123;print $1,$3&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk  -F: <span class="string">&#x27;$3&lt;1000&#123;print $1,$3&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk  -F: <span class="string">&#x27;$NF==&quot;/bin/bash&quot;&#123;print $1,$NF&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">&#x27;$NF==&quot;/bin/bash&quot;&#123;print $1,$NF&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">&#x27;$NF ~ /bash$/&#123;print $1,$NF&#125;&#x27;</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="built_in">seq</span> 10 | awk <span class="string">&#x27;NR&gt;=3 &amp;&amp; NR&lt;=6&#x27;</span></span><br><span class="line">awk <span class="string">&#x27;NR&gt;=3 &amp;&amp; NR&lt;=6&#123;print NR,$0&#125;&#x27;</span> /etc/passwd</span><br><span class="line">sed -n <span class="string">&#x27;3,6p&#x27;</span> /etc/passwd</span><br><span class="line">awk <span class="string">&#x27;/^bin/,/^adm/&#x27;</span> /etc/passwd</span><br><span class="line">sed -n <span class="string">&#x27;/^bin/,/^adm/p&#x27;</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">awk -F : <span class="string">&#x27;BEGIN &#123;print &quot;USER USERID&quot;&#125; &#123;print $1&quot;:&quot;$3&#125; END&#123;print &quot;END FILE&quot;&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">&#x27;&#123;print &quot;USER USERID&quot;;print $1&quot;:&quot;$3&#125; END&#123;print &quot;END FILE&quot;&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">&#x27;BEGIN&#123;print &quot;USER UID \n--------------- &quot;&#125;&#123;print $1,$3&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">&#x27;BEGIN&#123;print &quot;USER UID \n--------&quot;&#125;&#123;print $1,$3&#125;END&#123;print &quot;==========&quot;&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F:   <span class="string">&#x27;BEGIN&#123;printf &quot;--------------------------------\n%-20s|%10s|\n--------------------------------\n&quot;,&quot;username&quot;,&quot;uid&quot;&#125;&#123;printf &quot;%-20s|%10d|\n--------------------------------\n&quot;,$1,$3&#125;&#x27;</span> /etc/passwd</span><br></pre></td></tr></table></figure><h4 id="条件判断-if-else"><a href="#条件判断-if-else" class="headerlink" title="条件判断 if-else"></a>条件判断 if-else</h4><p>语法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if(condition)&#123;statement;…&#125;[else statement]</span><br><span class="line">if(condition1)&#123;statement1&#125;else if(condition2)&#123;statement2&#125;else if(condition3)</span><br><span class="line">&#123;statement3&#125;...... else &#123;statementN&#125;</span><br></pre></td></tr></table></figure><p>使用场景：对awk取得的整行或某个字段做条件判断</p><p>范例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">awk -F: <span class="string">&#x27;&#123;if($3&gt;=1000)print $1,$3&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">&#x27;&#123;if($3&lt;=100)&#123;print &quot;&lt;=100&quot;,$3&#125;else if ($3&lt;=1000) &#123;print &quot;&lt;=1000&quot;,$3&#125; else&#123;print &quot;&gt;=1000&quot;,$3&#125;&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">&#x27;&#123;if($NF==&quot;/bin/bash&quot;) print $1&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk <span class="string">&#x27;&#123;if(NF&gt;5) print $0&#125;&#x27;</span> /etc/fstab</span><br><span class="line">awk -F: <span class="string">&#x27;&#123;if($3&gt;=1000) &#123;printf &quot;Common user: %s\n&quot;,$1&#125; else &#123;printf &quot;root or Sysuser: %s\n&quot;,$1&#125;&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">&#x27;&#123;if($3&gt;=1000) printf &quot;Common user: %s\n&quot;,$1; else printf &quot;root or Sysuser: %s\n&quot;,$1&#125;&#x27;</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">df</span> -h|awk -F% <span class="string">&#x27;/^\/dev\/sd/&#123;print $1&#125;&#x27;</span>| awk <span class="string">&#x27;$NF&gt;=80&#123;print $1,$5&#125;&#x27;</span></span><br><span class="line"><span class="built_in">df</span> | awk -F<span class="string">&quot;[[:space:]]+|%&quot;</span> <span class="string">&#x27;/^\/dev\/sd/&#123;if($5&gt;80)print $1,$5&#125;&#x27;</span></span><br><span class="line"><span class="built_in">df</span> | awk -F<span class="string">&#x27; +|%&#x27;</span> <span class="string">&#x27;/^\/dev\/sd/&#123;if($5&gt;=10)print $1,$5&#125;&#x27;</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123; test=100;if(test&gt;90)&#123;print &quot;very good&quot;&#125; else if(test&gt;60)&#123; print &quot;good&quot;&#125;else&#123;print &quot;no pass&quot;&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">df</span> | awk -F<span class="string">&#x27;[ %]+&#x27;</span> <span class="string">&#x27;/\/dev\/.d./&#123;if($5&gt;=10)&#123;print $1,$5&#125;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">df</span> | awk -F<span class="string">&#x27; +|%&#x27;</span> <span class="string">&#x27;/^\/dev\/sd/&#123;if($5&gt;=10)print $1,$5&#125;&#x27;</span></span><br><span class="line"><span class="built_in">df</span> | awk -F<span class="string">&#x27;[[:space:]]+|%&#x27;</span> <span class="string">&#x27;/^\/dev\/sd/&#123;if($5&gt;=10)print $1,$5&#125;&#x27;</span></span><br><span class="line"><span class="built_in">df</span> | awk -F<span class="string">&quot;[ %]+&quot;</span> <span class="string">&#x27;/^\/dev\/sd/&#123;if($(NF-1)&gt;10)print $(NF-1)&quot; full&quot;;else &#123;print $(NF-1)&quot; OK&quot;&#125;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">df</span> | awk -F<span class="string">&quot;[ %]+&quot;</span> <span class="string">&#x27;/^\/dev\/sd/&#123;if($(NF-1)&gt;10)&#123;print $(NF-1)&quot; full&quot;&#125;else &#123;print $(NF-1)&quot; OK&quot;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="条件判断-switch"><a href="#条件判断-switch" class="headerlink" title="条件判断 switch"></a>条件判断 switch</h4><p>语法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">switch(expression) &#123;case VALUE1 or /REGEXP/: statement1; case VALUE2 or </span><br><span class="line">/REGEXP2/: statement2; ...; default: statementn&#125;</span><br></pre></td></tr></table></figure><h4 id="循环-while"><a href="#循环-while" class="headerlink" title="循环 while"></a>循环 while</h4><p>语法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">while (condition) &#123;statement;…&#125;</span><br></pre></td></tr></table></figure><p>条件“真”，进入循环；条件“假”，退出循环</p><p>使用场景：</p><ul><li>对一行内的多个字段逐一类似处理时使用</li><li>对数组中的各元素逐一处理时使用</li></ul><p>范例</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">awk -v i=1 -v <span class="built_in">sum</span>=0 <span class="string">&#x27;BEGIN&#123;while(i&lt;=100)&#123;sum+=i;i++&#125;;print sum&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#内置函数length()返回字符数，而非字节数</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;print length(&quot;hello&quot;)&#125;&#x27;</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;print length(&quot;马哥教育&quot;)&#125;&#x27;</span></span><br><span class="line">awk <span class="string">&#x27;/^[[:space:]]*linux16/&#123;i=1;while(i&lt;=NF)&#123;print $i,length($i); i++&#125;&#125;&#x27;</span> /etc/grub2.cfg</span><br><span class="line">awk <span class="string">&#x27;/^[[:space:]]*linux16/&#123;i=1;while(i&lt;=NF) &#123;if(length($i)&gt;=10)&#123;print $i,length($i)&#125;; i++&#125;&#125;&#x27;</span> /etc/grub2.cfg</span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123; total=0;i=1;while(i&lt;=100)&#123;total+=i;i++&#125;;print total&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>4.3.10 循环 do-while<br>语法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">do &#123;statement;…&#125;while(condition)</span><br></pre></td></tr></table></figure><p>意义：无论真假，至少执行一次循环体</p><p>范例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;BEGIN&#123; total=0;i=1;do&#123; total+=i;i++;&#125;while(i&lt;=100);print total&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="循环-for"><a href="#循环-for" class="headerlink" title="循环 for"></a>循环 for</h4><p>语法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for(expr1;expr2;expr3) &#123;statement;…&#125;</span><br></pre></td></tr></table></figure><p>常见用法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for(variable assignment;condition;iteration process) &#123;for-body&#125;</span><br></pre></td></tr></table></figure><p>特殊用法：能够遍历数组中的元素</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for(var in array) &#123;for-body&#125;</span><br></pre></td></tr></table></figure><p>范例:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;BEGIN&#123;sum=0;for(i=1;i&lt;=100;i++)&#123;sum+=i&#125;;print sum&#125;&#x27;</span></span><br><span class="line"><span class="keyword">for</span>((i=1,<span class="built_in">sum</span>=0;i&lt;=100;i++));<span class="keyword">do</span> <span class="built_in">let</span> <span class="built_in">sum</span>+=i;<span class="keyword">done</span>;<span class="built_in">echo</span> <span class="variable">$sum</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;total=0;for(i=1;i&lt;=100;i++)&#123;total+=i&#125;;print total&#125;&#x27;</span></span><br><span class="line">awk <span class="string">&#x27;/^[[:space:]]*linux16/&#123;for(i=1;i&lt;=NF;i++) &#123;print $i,length($i)&#125;&#125;&#x27;</span> /etc/grub2.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment"># 性能比较</span></span><br><span class="line">time (awk <span class="string">&#x27;BEGIN&#123; total=0;for(i=0;i&lt;=10000;i++)&#123;total+=i;&#125;;print total;&#125;&#x27;</span>)</span><br><span class="line">time (total=0;<span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10000&#125;;<span class="keyword">do</span> total=$((<span class="variable">$total</span>+i));<span class="keyword">done</span>;<span class="built_in">echo</span> <span class="variable">$total</span>)</span><br><span class="line">time (<span class="keyword">for</span> ((i=0;i&lt;=10000;i++));<span class="keyword">do</span> <span class="built_in">let</span> total+=i;<span class="keyword">done</span>;<span class="built_in">echo</span> <span class="variable">$total</span>)</span><br><span class="line">time (<span class="built_in">seq</span> –s ”+” 10000|bc)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取出字符串中的数字</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;dsFUs34tg*fs5a%8ar%$#@&#x27;</span> |awk -F <span class="string">&quot;&quot;</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  for(i=1;i&lt;=NF;i++) </span></span><br><span class="line"><span class="string"> &#123;  </span></span><br><span class="line"><span class="string">    if ($i ~ /[0-9]/)             </span></span><br><span class="line"><span class="string">   &#123;</span></span><br><span class="line"><span class="string">      str=(str $i)</span></span><br><span class="line"><span class="string">   &#125;  </span></span><br><span class="line"><span class="string"> &#125; </span></span><br><span class="line"><span class="string"> print str</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="continue-和-break"><a href="#continue-和-break" class="headerlink" title="continue 和 break"></a>continue 和 break</h4><ul><li>continue 中断本次循环</li><li>break 中断整个循环</li></ul><p>格式：</p><ul><li>continue [n]</li><li>break [n]</li></ul><p>范例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#awk &#x27;BEGIN&#123;for(i=1;i&lt;=100;i++)&#123;if(i==50)continue;sum+=i&#125;;print sum&#125;&#x27;</span></span><br><span class="line">5000</span><br><span class="line">[root@centos8 ~]<span class="comment">#awk &#x27;BEGIN&#123;for(i=1;i&lt;=100;i++)&#123;if(i==50)break;sum+=i&#125;;print </span></span><br><span class="line"><span class="built_in">sum</span>&#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">1225</span></span><br><span class="line"><span class="string">[root@centos8 ~]#awk &#x27;</span>BEGIN&#123;<span class="built_in">sum</span>=0;<span class="keyword">for</span>(i=1;i&lt;=100;i++)</span><br><span class="line">&#123;<span class="keyword">if</span>(i%2==0)<span class="built_in">continue</span>;<span class="built_in">sum</span>+=i&#125;<span class="built_in">print</span> <span class="built_in">sum</span>&#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">2500</span></span><br><span class="line"><span class="string">[root@centos8 ~]#awk &#x27;</span>BEGIN&#123;<span class="built_in">sum</span>=0;<span class="keyword">for</span>(i=1;i&lt;=100;i++)</span><br><span class="line">&#123;<span class="keyword">if</span>(i==50)<span class="built_in">break</span>;<span class="built_in">sum</span>+=i&#125;<span class="built_in">print</span> <span class="built_in">sum</span>&#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">1225</span></span><br></pre></td></tr></table></figure><h4 id="next"><a href="#next" class="headerlink" title="next"></a>next</h4><p>next 可以提前结束对本行处理而直接进入下一行处理（awk自身循环）</p><p>范例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#awk -F: &#x27;&#123;if($3%2!=0) next; print $1,$3&#125;&#x27; /etc/passwd</span></span><br><span class="line">root 0</span><br><span class="line">daemon 2</span><br><span class="line">lp 4</span><br><span class="line">shutdown 6</span><br><span class="line">mail 8</span><br><span class="line">games 12</span><br><span class="line">ftp 14</span><br><span class="line">nobody 65534</span><br><span class="line">polkitd 998</span><br><span class="line">gluster 996</span><br><span class="line">rtkit 172</span><br><span class="line">rpc 32</span><br><span class="line">chrony 994</span><br><span class="line">saslauth 992</span><br><span class="line">clevis 984</span><br><span class="line">pegasus 66</span><br><span class="line">colord 982</span><br><span class="line">setroubleshoot 980</span><br><span class="line">gdm 42</span><br><span class="line">gnome-initial-setup 978</span><br><span class="line">sshd 74</span><br><span class="line">avahi 70</span><br><span class="line">tcpdump 72</span><br><span class="line">wang 1000</span><br></pre></td></tr></table></figure><h4 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h4><p>awk的数组为关联数组</p><p>格式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array_name[index-expression]</span><br></pre></td></tr></table></figure><p>index-expression</p><ul><li>利用数组，实现 k&#x2F;v 功能</li><li>可使用任意字符串；字符串要使用双引号括起来</li><li>如果某数组元素事先不存在，在引用时，awk会自动创建此元素，并将其值初始化为“空串”</li><li>若要判断数组中是否存在某元素，要使用“index in array”格式进行遍历</li></ul><p>范例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#awk </span></span><br><span class="line"><span class="string">&#x27;BEGIN&#123;weekdays[&quot;mon&quot;]=&quot;Monday&quot;;weekdays[&quot;tue&quot;]=&quot;Tuesday&quot;;print </span></span><br><span class="line"><span class="string">weekdays[&quot;mon&quot;]&#125;&#x27;</span></span><br><span class="line">Monday</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;!line[$0]++&#x27;</span> dupfile</span><br><span class="line">awk <span class="string">&#x27;&#123;print !line[$0]++, $0, line[$0]&#125;&#x27;</span> dupfile</span><br><span class="line">awk <span class="string">&#x27;&#123;!line[$0]++;print $0, line[$0]&#125;&#x27;</span> dupfile</span><br><span class="line"></span><br><span class="line">范例：判断数组索引是否存在</span><br><span class="line">[root@centos8 ~]<span class="comment"># awk &#x27;BEGIN&#123;array[&quot;i&quot;]=&quot;x&quot;; array[&quot;j&quot;]=&quot;y&quot; ; print &quot;i&quot; in </span></span><br><span class="line">array, <span class="string">&quot;y&quot;</span> <span class="keyword">in</span> array &#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">1 0</span></span><br><span class="line"><span class="string">[root@centos8 ~]#awk &#x27;</span>BEGIN&#123;array[<span class="string">&quot;i&quot;</span>]=<span class="string">&quot;x&quot;</span>; array[<span class="string">&quot;j&quot;</span>]=<span class="string">&quot;y&quot;</span> ;<span class="keyword">if</span> (<span class="string">&quot;i&quot;</span> <span class="keyword">in</span> array ) </span><br><span class="line">&#123;<span class="built_in">print</span> <span class="string">&quot;存在&quot;</span>&#125;<span class="keyword">else</span>&#123;<span class="built_in">print</span> <span class="string">&quot;不存在&quot;</span>&#125;&#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">存在</span></span><br><span class="line"><span class="string">[root@centos8 ~]#awk &#x27;</span>BEGIN&#123;array[<span class="string">&quot;i&quot;</span>]=<span class="string">&quot;x&quot;</span>; array[<span class="string">&quot;j&quot;</span>]=<span class="string">&quot;y&quot;</span> ;<span class="keyword">if</span> (<span class="string">&quot;abc&quot;</span> <span class="keyword">in</span> array ) </span><br><span class="line">&#123;<span class="built_in">print</span> <span class="string">&quot;存在&quot;</span>&#125;<span class="keyword">else</span>&#123;<span class="built_in">print</span> <span class="string">&quot;不存在&quot;</span>&#125;&#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">不存在</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">若要遍历数组中的每个元素，要使用 for 循环</span></span><br><span class="line"><span class="string">for(var in array) &#123;for-body&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">注意：var会遍历array的每个索引</span></span><br><span class="line"><span class="string">范例：遍历数组</span></span><br><span class="line"><span class="string">[root@centos8 ~]#awk </span></span><br><span class="line"><span class="string">&#x27;</span>BEGIN&#123;weekdays[<span class="string">&quot;mon&quot;</span>]=<span class="string">&quot;Monday&quot;</span>;weekdays[<span class="string">&quot;tue&quot;</span>]=<span class="string">&quot;Tuesday&quot;</span>;<span class="keyword">for</span>(i <span class="keyword">in</span> weekdays) </span><br><span class="line">&#123;<span class="built_in">print</span> i,weekdays[i]&#125;&#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">tue Tuesday</span></span><br><span class="line"><span class="string">mon Monday</span></span><br><span class="line"><span class="string">[root@centos8 ~]#awk </span></span><br><span class="line"><span class="string">&#x27;</span>BEGIN&#123;students[1]=<span class="string">&quot;daizong&quot;</span>;students[2]=<span class="string">&quot;junzong&quot;</span>;students[3]=<span class="string">&quot;kunzong&quot;</span>;<span class="keyword">for</span>(x </span><br><span class="line"><span class="keyword">in</span> students)&#123;<span class="built_in">print</span> x<span class="string">&quot;:&quot;</span>students[x]&#125;&#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">1:daizong</span></span><br><span class="line"><span class="string">2:junzong</span></span><br><span class="line"><span class="string">3:kunzong</span></span><br><span class="line"><span class="string">[root@centos8 ~]#awk &#x27;</span>BEGIN &#123;</span><br><span class="line">a[<span class="string">&quot;x&quot;</span>] = <span class="string">&quot;welcome&quot;</span></span><br><span class="line">a[<span class="string">&quot;y&quot;</span>] = <span class="string">&quot;to&quot;</span></span><br><span class="line">a[<span class="string">&quot;z&quot;</span>] = <span class="string">&quot;Magedu&quot;</span></span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> a) &#123;</span><br><span class="line">     <span class="built_in">print</span> i,a[i]</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">x welcome</span></span><br><span class="line"><span class="string">y to</span></span><br><span class="line"><span class="string">z Magedu</span></span><br><span class="line"><span class="string">[root@centos8 ~]#awk -F: &#x27;</span>&#123;user[<span class="variable">$1</span>]=<span class="variable">$3</span>&#125;END&#123;<span class="keyword">for</span>(i <span class="keyword">in</span> user)&#123;<span class="built_in">print</span> <span class="string">&quot;username: </span></span><br><span class="line"><span class="string">&quot;</span>i,<span class="string">&quot;uid: &quot;</span>user[i]&#125;&#125;<span class="string">&#x27; /etc/passwd</span></span><br><span class="line"><span class="string">username: adm uid: 3</span></span><br><span class="line"><span class="string">username: rpc uid: 32</span></span><br><span class="line"><span class="string">username: dnsmasq uid: 985</span></span><br><span class="line"><span class="string">username: radvd uid: 75</span></span><br><span class="line"><span class="string">username: sync uid: 5</span></span><br><span class="line"><span class="string">username: mail uid: 8</span></span><br><span class="line"><span class="string">username: exim uid: 93</span></span><br><span class="line"><span class="string">username: tss uid: 59</span></span><br><span class="line"><span class="string">username: gluster uid: 996</span></span><br><span class="line"><span class="string">username: unbound uid: 995</span></span><br><span class="line"><span class="string">username: halt uid: 7</span></span><br><span class="line"><span class="string">显示主机的连接状态出现的次数</span></span><br><span class="line"><span class="string">[root@centos8 ~]#awk &#x27;</span>NR!=1&#123;<span class="built_in">print</span> <span class="variable">$1</span>&#125;<span class="string">&#x27; ss.log |sort |uniq -c</span></span><br><span class="line"><span class="string">    118 ESTAB</span></span><br><span class="line"><span class="string">      1 FIN-WAIT-1</span></span><br><span class="line"><span class="string">     11 LAST-ACK</span></span><br><span class="line"><span class="string">[root@centos8 ~]#cat ss.log | sed -nr &#x27;</span>1!s/^([^0-9]+) .*/\1/p<span class="string">&#x27;|sort |uniq -c</span></span><br><span class="line"><span class="string">    529 ESTAB    </span></span><br><span class="line"><span class="string">      9 LISTEN   </span></span><br><span class="line"><span class="string">    128 SYN-RECV </span></span><br><span class="line"><span class="string">     95 TIME-WAIT</span></span><br><span class="line"><span class="string">     </span></span><br><span class="line"><span class="string">[root@centos8 ~]#ss -ant | awk &#x27;</span>NR!=1&#123;state[<span class="variable">$1</span>]++&#125;END&#123;<span class="keyword">for</span>(i <span class="keyword">in</span> state)&#123;<span class="built_in">print</span> </span><br><span class="line">i,state[i]&#125;&#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">SYN-RECV 128</span></span><br><span class="line"><span class="string">LISTEN 9</span></span><br><span class="line"><span class="string">ESTAB 529</span></span><br><span class="line"><span class="string">TIME-WAIT 95</span></span><br><span class="line"><span class="string">[root@centos8 ~]#netstat -tan | awk &#x27;</span>/^tcp/&#123;state[<span class="variable">$NF</span>]++&#125;END&#123;<span class="keyword">for</span>(i <span class="keyword">in</span> state)</span><br><span class="line">&#123;<span class="built_in">print</span> i,state[i]&#125;&#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">LISTEN 9</span></span><br><span class="line"><span class="string">SYN_RECV 126</span></span><br><span class="line"><span class="string">ESTABLISHED 523</span></span><br><span class="line"><span class="string">FIN_WAIT2 40</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@centos8 ~]#awk &#x27;</span>&#123;ip[<span class="variable">$1</span>]++&#125;END&#123;<span class="keyword">for</span>(i <span class="keyword">in</span> ip)&#123;<span class="built_in">print</span> i,ip[i]&#125;&#125;<span class="string">&#x27; </span></span><br><span class="line"><span class="string">/var/log/httpd/access_log</span></span><br><span class="line"><span class="string">172.20.0.200 1482</span></span><br><span class="line"><span class="string">172.20.21.121 2</span></span><br><span class="line"><span class="string">172.20.30.91 29</span></span><br><span class="line"><span class="string">172.16.102.29 864</span></span><br><span class="line"><span class="string">172.20.0.76 1565</span></span><br><span class="line"><span class="string">172.20.9.9 15</span></span><br><span class="line"><span class="string">172.20.1.125 463</span></span><br><span class="line"><span class="string">172.20.61.11 2</span></span><br><span class="line"><span class="string">172.20.73.73 198</span></span><br><span class="line"><span class="string">[root@centos8 ~]#awk &#x27;</span>&#123;ip[<span class="variable">$1</span>]++&#125;END&#123;<span class="keyword">for</span>(i <span class="keyword">in</span> ip)&#123;<span class="built_in">print</span> ip[i],i&#125;&#125;<span class="string">&#x27; access_log </span></span><br><span class="line"><span class="string">|sort -nr| head -3</span></span><br><span class="line"><span class="string">4870 172.20.116.228</span></span><br><span class="line"><span class="string">3429 172.20.116.208</span></span><br><span class="line"><span class="string">2834 172.20.0.222</span></span><br><span class="line"><span class="string">[root@centos8 ~]#awk &#x27;</span>&#123;ip[<span class="variable">$1</span>]++&#125;END&#123;<span class="keyword">for</span>(i <span class="keyword">in</span> ip)&#123;<span class="built_in">print</span> i,ip[i]&#125;&#125;<span class="string">&#x27; access_log </span></span><br><span class="line"><span class="string">|sort -k2 -nr|head -3</span></span><br><span class="line"><span class="string">172.20.116.228 4870</span></span><br><span class="line"><span class="string">172.20.116.208 3429</span></span><br><span class="line"><span class="string">172.20.0.222 2834</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">范例：封掉查看访问日志中连接次数超过1000次的IP</span></span><br><span class="line"><span class="string">[root@centos8 ~]#awk &#x27;</span>&#123;ip[<span class="variable">$1</span>]++&#125;END&#123;<span class="keyword">for</span>(i <span class="keyword">in</span> ip)&#123;<span class="keyword">if</span>(ip[i]&gt;=1000)</span><br><span class="line">&#123;system(<span class="string">&quot;iptables -A INPUT -s &quot;</span>i<span class="string">&quot; -j REJECT&quot;</span>)&#125;&#125;&#125;<span class="string">&#x27; nginx.access.log-20200428</span></span><br><span class="line"><span class="string">范例：多维数组</span></span><br><span class="line"><span class="string">[root@centos8 ~]#awk &#x27;</span>BEGIN&#123;</span><br><span class="line">&gt; array[1][1]=11</span><br><span class="line">&gt; array[1][2]=12</span><br><span class="line">&gt; array[1][3]=13</span><br><span class="line">&gt; array[2][1]=21</span><br><span class="line">&gt; array[2][2]=22</span><br><span class="line">&gt; array[2][3]=23</span><br><span class="line">&gt; <span class="keyword">for</span> (i <span class="keyword">in</span> array)</span><br><span class="line">&gt;     <span class="keyword">for</span> (j <span class="keyword">in</span> array[i])</span><br><span class="line">&gt;         <span class="built_in">print</span> array[i][j]</span><br><span class="line">&gt; &#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">11</span></span><br><span class="line"><span class="string">12</span></span><br><span class="line"><span class="string">13</span></span><br><span class="line"><span class="string">21</span></span><br><span class="line"><span class="string">22</span></span><br><span class="line"><span class="string">23</span></span><br><span class="line"><span class="string">root@ubuntu2004:~# cat score.txt</span></span><br><span class="line"><span class="string">name sex score</span></span><br><span class="line"><span class="string">alice f  100</span></span><br><span class="line"><span class="string">bob   m  90</span></span><br><span class="line"><span class="string">ming m  95</span></span><br><span class="line"><span class="string">hong f  90</span></span><br><span class="line"><span class="string">root@ubuntu2004:~# awk &#x27;</span>NR!=1&#123;<span class="keyword">if</span>(<span class="variable">$2</span>==<span class="string">&quot;m&quot;</span>)</span><br><span class="line">&#123;m_sum+=<span class="variable">$3</span>;m_num++&#125;<span class="keyword">else</span>&#123;f_sum+=<span class="variable">$3</span>;f_num++&#125;&#125;END&#123;<span class="built_in">print</span> <span class="string">&quot;男生平均成绩</span></span><br><span class="line"><span class="string">=&quot;</span>m_sum/m_num,<span class="string">&quot;女生平均成绩=&quot;</span>f_sum/f_num&#125;<span class="string">&#x27; score.txt</span></span><br><span class="line"><span class="string">男生平均成绩=92.5 女生平均成绩=95</span></span><br><span class="line"><span class="string">root@ubuntu2004:~# awk &#x27;</span>NR!=1&#123;score[<span class="variable">$2</span>]+=<span class="variable">$3</span>;num[<span class="variable">$2</span>]++&#125;END&#123;<span class="keyword">for</span>(i <span class="keyword">in</span> score)&#123;<span class="built_in">print</span> </span><br><span class="line">i,score[i]/num[i]&#125;&#125;<span class="string">&#x27; score.txt </span></span><br><span class="line"><span class="string">m 92.5</span></span><br><span class="line"><span class="string">f 95</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">root@ubuntu2004:~# awk &#x27;</span>NR!=1&#123;score[<span class="variable">$2</span>]+=<span class="variable">$3</span>;num[<span class="variable">$2</span>]++&#125;END&#123;<span class="keyword">for</span>(i <span class="keyword">in</span> score)</span><br><span class="line">&#123;<span class="keyword">if</span>(i==<span class="string">&quot;m&quot;</span>)&#123;<span class="built_in">print</span> <span class="string">&quot;男生平均成绩=&quot;</span>,score[i]/num[i]&#125;<span class="keyword">else</span>&#123;<span class="built_in">print</span> <span class="string">&quot;女生平均成绩</span></span><br><span class="line"><span class="string">=&quot;</span>,score[i]/num[i]&#125;&#125;&#125;<span class="string">&#x27; score.txt </span></span><br><span class="line"><span class="string">男生平均成绩= 92.5</span></span><br><span class="line"><span class="string">女生平均成绩= 95</span></span><br></pre></td></tr></table></figure><h4 id="awk-函数"><a href="#awk-函数" class="headerlink" title="awk 函数"></a>awk 函数</h4><p>awk 的函数分为内置和自定义函数</p><p><strong>常见内置函数</strong></p><ul><li>rand()：返回0和1之间一个随机数</li><li>srand()：配合rand() 函数,生成随机数的种子</li><li>int()：返回整数</li><li>length([s])：返回指定字符串的长度</li><li>sub(r,s,[t])：对t字符串搜索r表示模式匹配的内容，并将第一个匹配内容替换为s</li><li>gsub(r,s,[t])：对t字符串进行搜索r表示的模式匹配的内容，并全部替换为s所表示的内容</li><li>split(s,array,[r])：以r为分隔符，切割字符串s，并将切割后的结果保存至array所表示的数组中，第一个索引值为1,第二个索引值为2,…</li><li>system(‘cmd’)：可以awk中调用shell命令，空格是awk中的字符串连接符，如果system中需要使用awk中的变量可以使用空格分隔，或者说除了awk的变量外其他一律用””引用起来</li><li>systime() 当前时间到1970年1月1日的秒数</li><li>strftime() 指定时间格式</li></ul><p>范例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#awk &#x27;BEGIN&#123;srand();print rand()&#125;&#x27;</span></span><br><span class="line">0.790437</span><br><span class="line">[root@centos8 ~]<span class="comment">#awk &#x27;BEGIN&#123;srand();print rand()&#125;&#x27;</span></span><br><span class="line">0.283736</span><br><span class="line">[root@centos8 ~]<span class="comment">#awk &#x27;BEGIN&#123;srand();print rand()&#125;&#x27;</span></span><br><span class="line">0.948082</span><br><span class="line">[root@centos8 ~]<span class="comment">#awk &#x27;BEGIN&#123;srand();print rand()&#125;&#x27;</span></span><br><span class="line">0.371798</span><br><span class="line">[root@centos8 ~]<span class="comment">#awk &#x27;BEGIN&#123;srand(); for (i=1;i&lt;=10;i++)print int(rand()*100)&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">范例: 统计用户名的长度</span><br><span class="line">root@ubuntu2004:~<span class="comment"># cut -d: -f1 /etc/passwd | awk &#x27;&#123;print length()&#125;&#x27;</span></span><br><span class="line">root@ubuntu2004:~<span class="comment"># awk -F: &#x27;&#123;print length($1)&#125;&#x27; /etc/passwd</span></span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#echo &quot;2008:08:08 08:08:08&quot; | awk &#x27;sub(/:/,&quot;-&quot;,$1)&#x27;</span></span><br><span class="line">2008-08:08 08:08:08</span><br><span class="line">[root@centos8 ~]<span class="comment">#echo &quot;2008:08:08 08:08:08&quot; | awk &#x27;&#123;sub(/:/,&quot;-&quot;,$1);print $0&#125;&#x27;</span></span><br><span class="line">2008-08:08 08:08:08</span><br><span class="line">[root@centos8 ~]<span class="comment">#echo &quot;2008:08:08 08:08:08&quot; | awk &#x27;gsub(/:/,&quot;-&quot;,$0)&#x27;</span></span><br><span class="line">2008-08-08 08-08-08</span><br><span class="line">[root@centos8 ~]<span class="comment">#echo &quot;2008:08:08 08:08:08&quot; | awk &#x27;&#123;gsub(/:/,&quot;-&quot;,$0);print $0&#125;&#x27;</span></span><br><span class="line">2008-08-08 08-08-08</span><br><span class="line">[root@centos8 ~]<span class="comment">#netstat -tn | awk </span></span><br><span class="line"><span class="string">&#x27;/^tcp/&#123;split($5,ip,&quot;:&quot;);count[ip[1]]++&#125;END&#123;for(i in count)&#123;print i,count[i]&#125;&#125;&#x27;</span></span><br><span class="line">10.0.0.1 1</span><br><span class="line">10.0.0.6 1</span><br><span class="line">10.0.0.7 673</span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;system(&quot;hostname&quot;)&#125;&#x27;</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;score=100; system(&quot;echo your score is &quot; score) &#125;&#x27;</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#netstat -tn | awk </span></span><br><span class="line"><span class="string">&#x27;/^tcp/&#123;split($5,ip,&quot;:&quot;);count[ip[1]]++&#125;END&#123;for(i in count)&#123;if(count[i]&gt;=10)</span></span><br><span class="line"><span class="string">&#123;system(&quot;iptables -A INPUT -s &quot;i&quot; -j REJECT&quot;)&#125;&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#awk &#x27;BEGIN&#123;print systime()&#125;&#x27;</span></span><br><span class="line">1609917829</span><br><span class="line">[root@centos8 ~]<span class="comment">#awk &#x27;BEGIN&#123;print strftime(&quot;%Y-%m-%dT%H:%M&quot;,systime()-3600)&#125;&#x27;</span></span><br><span class="line">2021-01-06T14:24</span><br></pre></td></tr></table></figure><h4 id="自定义函数"><a href="#自定义函数" class="headerlink" title="自定义函数"></a>自定义函数</h4><p>自定义函数格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function name ( parameter, parameter, ... ) &#123;</span><br><span class="line">   statements</span><br><span class="line">   return expression</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>范例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#cat func.awk</span></span><br><span class="line"><span class="keyword">function</span> max(x,y) &#123;</span><br><span class="line"> x&gt;y?var=x:var=y</span><br><span class="line"> <span class="built_in">return</span> var</span><br><span class="line">&#125;</span><br><span class="line">BEGIN&#123;<span class="built_in">print</span> max(a,b)&#125;</span><br><span class="line">[root@centos8 ~]<span class="comment">#awk -v a=30 -v b=20 -f func.awk</span></span><br><span class="line">30</span><br></pre></td></tr></table></figure><h4 id="awk-脚本"><a href="#awk-脚本" class="headerlink" title="awk 脚本"></a>awk 脚本</h4><p>将awk程序写成脚本，直接调用或执行</p><p>范例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#cat passwd.awk </span></span><br><span class="line">&#123;<span class="keyword">if</span>(<span class="variable">$3</span>&gt;=1000)<span class="built_in">print</span> <span class="variable">$1</span>,<span class="variable">$3</span>&#125;</span><br><span class="line">[root@centos8 ~]<span class="comment">#awk -F: -f passwd.awk /etc/passwd</span></span><br><span class="line">nobody 65534</span><br><span class="line">wang 1000</span><br><span class="line">mage 1001</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#cat test.awk</span></span><br><span class="line"><span class="comment">#!/bin/awk -f</span></span><br><span class="line"><span class="comment">#this is a awk script</span></span><br><span class="line">&#123;<span class="keyword">if</span>(<span class="variable">$3</span>&gt;=1000)<span class="built_in">print</span> <span class="variable">$1</span>,<span class="variable">$3</span>&#125;</span><br><span class="line">[root@centos8 ~]<span class="comment">#chmod +x test.awk</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#./test.awk -F: /etc/passwd</span></span><br><span class="line">nobody 65534</span><br><span class="line">wang 1000</span><br><span class="line">mage 1001</span><br></pre></td></tr></table></figure><p>向awk脚本传递参数</p><p>格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awkfile  var=value  var2=value2... Inputfile</span><br></pre></td></tr></table></figure><p>注意：在BEGIN过程中不可用。直到首行输入完成以后，变量才可用。可以通过-v 参数，让awk在执行 BEGIN之前得到变量的值。命令行中每一个指定的变量都需要一个-v参数</p><p>范例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#cat test2.awk </span></span><br><span class="line"><span class="comment">#!/bin/awk -f</span></span><br><span class="line">&#123;<span class="keyword">if</span>(<span class="variable">$3</span> &gt;=min &amp;&amp; <span class="variable">$3</span>&lt;=max)<span class="built_in">print</span> <span class="variable">$1</span>,<span class="variable">$3</span>&#125; </span><br><span class="line">[root@centos8 ~]<span class="comment">#chmod +x test2.awk</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#./test2.awk -F: min=100 max=200 /etc/passwd</span></span><br><span class="line">systemd-resolve 193</span><br><span class="line">rtkit 172</span><br><span class="line">pulse 171</span><br><span class="line">qemu 107</span><br><span class="line">usbmuxd 113</span><br><span class="line">abrt 173</span><br><span class="line"></span><br><span class="line">范例: 检查出最近一小时内访问nginx服务次数超过3次的客户端IP</span><br><span class="line">[root@VM_0_10_centos ~]<span class="comment"># cat check_nginx_log.awk </span></span><br><span class="line"><span class="comment">#!/usr/bin/awk -f</span></span><br><span class="line">BEGIN &#123;</span><br><span class="line"> beg=strftime(<span class="string">&quot;%Y-%m-%dT%H:%M&quot;</span>,systime()-3600) ;</span><br><span class="line"> <span class="comment">#定义一个小时前的时间，并格式化日期格式</span></span><br><span class="line"> end=strftime( <span class="string">&quot;%Y-%m-%dT%H:%M&quot;</span>,systime()-60) ;</span><br><span class="line"> <span class="comment">#定义结束时间</span></span><br><span class="line"> <span class="comment">#print beg;</span></span><br><span class="line"> <span class="comment">#print end;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$4</span> &gt; beg &amp;&amp; <span class="variable">$4</span> &lt; end &#123;<span class="comment">#定义取这个时间段内的日志</span></span><br><span class="line"> count[<span class="variable">$12</span>]+=1;<span class="comment">#利用ip当做数组下标，次数当做数组内容</span></span><br><span class="line">&#125;</span><br><span class="line">END &#123;</span><br><span class="line"> <span class="keyword">for</span>(i <span class="keyword">in</span> count)&#123;<span class="comment">#结束从数组取数据代表数组的下标，也就是ip</span></span><br><span class="line"> <span class="keyword">if</span>(count[i]&gt;3) &#123; <span class="comment">#如果次数大于3次，做操作</span></span><br><span class="line"> <span class="built_in">print</span> count [i]<span class="string">&quot; &quot;</span>i;</span><br><span class="line"> <span class="comment">#system(&quot;iptables -I INPUT -S”i”j DROP&quot; )</span></span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#awk -F&#x27;&quot;&#x27; -f check_nginx_log.awk /apps/nginx/logs/access.log</span></span><br><span class="line">[root@VM_0_10_centos ~]<span class="comment"># head /apps/nginx/logs/access_json.log -n3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@VM_0_10_centos ~]<span class="comment"># awk -F&#x27;&quot;&#x27; -f check_nginx_log.awk </span></span><br><span class="line">/apps/nginx/logs/access_json.log</span><br><span class="line">[root@centos8 ~]<span class="comment">#awk -F&quot;/&quot; &#x27;&#123;url[$3]++&#125;END&#123;for(i in url)&#123;print url[i],i&#125;&#125;&#x27; </span></span><br><span class="line">url.log |<span class="built_in">sort</span> -nr</span><br><span class="line"></span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Janvy Sun</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://janvysun.github.io/linux/32aa502c-8664-4215-8a99-5d76f7f1c5f3.html">https://janvysun.github.io/linux/32aa502c-8664-4215-8a99-5d76f7f1c5f3.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://janvysun.github.io" target="_blank">Janvy's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a></div><div class="post_share"><div class="social-share" data-image="/images/hexo.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/cmake/9c42e933-d2df-4f9d-a5b7-40995803ac39.html"><img class="prev-cover" src="/images/hexo.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">CMake 工程搭建</div></div></a></div><div class="next-post pull-right"><a href="/cmake/fcc1e0ef-8df4-46bf-9770-8999c44971d0.html"><img class="next-cover" src="/images/hexo.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">CMake 的常用指令</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/linux/617040d3-79e7-4894-8dc3-5fc160997846.html" title="Bash 脚本的创建与使用"><img class="cover" src="/images/hexo.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-01</div><div class="title">Bash 脚本的创建与使用</div></div></a></div><div><a href="/linux/ac6a581b-3788-4820-89c0-c55fff84aa06.html" title="Linux SSH"><img class="cover" src="/images/hexo.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-01</div><div class="title">Linux SSH</div></div></a></div><div><a href="/linux/8b36618d-c5a7-4e56-819d-22cab4fa41a5.html" title="Bash 脚本样例"><img class="cover" src="/images/hexo.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-14</div><div class="title">Bash 脚本样例</div></div></a></div><div><a href="/linux/095ae942-2e0b-4522-96ea-3eb24278c156.html" title="Bash 变量"><img class="cover" src="/images/hexo.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-04</div><div class="title">Bash 变量</div></div></a></div><div><a href="/linux/f2df8a80-8428-4044-8432-437966b910c5.html" title="Linux 启动设置"><img class="cover" src="/images/hexo.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-01</div><div class="title">Linux 启动设置</div></div></a></div><div><a href="/linux/c643ccd9-8a5f-4264-bb56-2d13cb4f386c.html" title="Linux 常用命令"><img class="cover" src="/images/hexo.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-13</div><div class="title">Linux 常用命令</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images/avatar.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">Janvy Sun</div><div class="author-info__description"></div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">154</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">47</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/janvysun" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:janvusun@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E6%9F%A5%E7%9C%8B%E5%B7%A5%E5%85%B7"><span class="toc-number">1.</span> <span class="toc-text">文本查看工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cat"><span class="toc-number">1.1.</span> <span class="toc-text">cat</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E9%A1%B9"><span class="toc-number">1.1.1.</span> <span class="toc-text">选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tac"><span class="toc-number">1.2.</span> <span class="toc-text">tac</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rev"><span class="toc-number">1.3.</span> <span class="toc-text">rev</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#more"><span class="toc-number">1.4.</span> <span class="toc-text">more</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#less"><span class="toc-number">1.5.</span> <span class="toc-text">less</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#head"><span class="toc-number">1.6.</span> <span class="toc-text">head</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E9%A1%B9-1"><span class="toc-number">1.6.1.</span> <span class="toc-text">选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E4%BE%8B"><span class="toc-number">1.6.2.</span> <span class="toc-text">范例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tail"><span class="toc-number">1.7.</span> <span class="toc-text">tail</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E9%A1%B9-2"><span class="toc-number">1.7.1.</span> <span class="toc-text">选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E4%BE%8B-1"><span class="toc-number">1.7.2.</span> <span class="toc-text">范例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cut"><span class="toc-number">1.8.</span> <span class="toc-text">cut</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E9%A1%B9-3"><span class="toc-number">1.8.1.</span> <span class="toc-text">选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E4%BE%8B-2"><span class="toc-number">1.8.2.</span> <span class="toc-text">范例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#paste"><span class="toc-number">1.9.</span> <span class="toc-text">paste</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E9%A1%B9-4"><span class="toc-number">1.9.1.</span> <span class="toc-text">选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E4%BE%8B-3"><span class="toc-number">1.9.2.</span> <span class="toc-text">范例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7"><span class="toc-number">2.</span> <span class="toc-text">文本分析工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#wc"><span class="toc-number">2.1.</span> <span class="toc-text">wc</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E9%A1%B9-5"><span class="toc-number">2.1.1.</span> <span class="toc-text">选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E4%BE%8B-4"><span class="toc-number">2.1.2.</span> <span class="toc-text">范例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sort"><span class="toc-number">2.2.</span> <span class="toc-text">sort</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E9%A1%B9-6"><span class="toc-number">2.2.1.</span> <span class="toc-text">选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E4%BE%8B-5"><span class="toc-number">2.2.2.</span> <span class="toc-text">范例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#uniq"><span class="toc-number">2.3.</span> <span class="toc-text">uniq</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E9%A1%B9-7"><span class="toc-number">2.3.1.</span> <span class="toc-text">选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E4%BE%8B-6"><span class="toc-number">2.3.2.</span> <span class="toc-text">范例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7"><span class="toc-number">3.</span> <span class="toc-text">文本处理工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#grep"><span class="toc-number">3.1.</span> <span class="toc-text">grep</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E9%A1%B9-8"><span class="toc-number">3.1.1.</span> <span class="toc-text">选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E4%BE%8B-7"><span class="toc-number">3.1.2.</span> <span class="toc-text">范例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sed"><span class="toc-number">3.2.</span> <span class="toc-text">sed</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9"><span class="toc-number">3.2.1.</span> <span class="toc-text">常用选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80-Address"><span class="toc-number">3.2.2.</span> <span class="toc-text">地址(Address)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4-Command"><span class="toc-number">3.2.3.</span> <span class="toc-text">命令(Command)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E6%9B%BF%E6%8D%A2"><span class="toc-number">3.2.4.</span> <span class="toc-text">查找替换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E4%BE%8B-8"><span class="toc-number">3.2.5.</span> <span class="toc-text">范例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#awk"><span class="toc-number">3.3.</span> <span class="toc-text">awk</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E9%A1%B9-9"><span class="toc-number">3.3.1.</span> <span class="toc-text">选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Program-%E6%A0%BC%E5%BC%8F"><span class="toc-number">3.3.2.</span> <span class="toc-text">Program 格式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E4%BD%9C-print"><span class="toc-number">3.3.3.</span> <span class="toc-text">动作 print</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#awk-%E5%8F%98%E9%87%8F"><span class="toc-number">3.3.4.</span> <span class="toc-text">awk 变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F"><span class="toc-number">3.3.5.</span> <span class="toc-text">自定义变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#printf"><span class="toc-number">3.3.6.</span> <span class="toc-text">printf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">3.3.7.</span> <span class="toc-text">操作符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8FPATTERN"><span class="toc-number">3.3.8.</span> <span class="toc-text">模式PATTERN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD-if-else"><span class="toc-number">3.3.9.</span> <span class="toc-text">条件判断 if-else</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD-switch"><span class="toc-number">3.3.10.</span> <span class="toc-text">条件判断 switch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF-while"><span class="toc-number">3.3.11.</span> <span class="toc-text">循环 while</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF-for"><span class="toc-number">3.3.12.</span> <span class="toc-text">循环 for</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#continue-%E5%92%8C-break"><span class="toc-number">3.3.13.</span> <span class="toc-text">continue 和 break</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#next"><span class="toc-number">3.3.14.</span> <span class="toc-text">next</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E7%BB%84"><span class="toc-number">3.3.15.</span> <span class="toc-text">数组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#awk-%E5%87%BD%E6%95%B0"><span class="toc-number">3.3.16.</span> <span class="toc-text">awk 函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="toc-number">3.3.17.</span> <span class="toc-text">自定义函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#awk-%E8%84%9A%E6%9C%AC"><span class="toc-number">3.3.18.</span> <span class="toc-text">awk 脚本</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/lyrics/1f1e25e2-0756-4881-9cc2-b146d03c0ae6.html" title="世界が終るまでは…"><img src="/images/hexo.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="世界が終るまでは…"></a><div class="content"><a class="title" href="/lyrics/1f1e25e2-0756-4881-9cc2-b146d03c0ae6.html" title="世界が終るまでは…">世界が終るまでは…</a><time datetime="2024-04-20T16:00:00.000Z" title="发表于 2024-04-21 00:00:00">2024-04-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/games/bdac0118-3bf7-43f9-9856-142e616b1ca4.html" title="我的世界攻略"><img src="/images/hexo.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="我的世界攻略"></a><div class="content"><a class="title" href="/games/bdac0118-3bf7-43f9-9856-142e616b1ca4.html" title="我的世界攻略">我的世界攻略</a><time datetime="2024-03-31T16:00:00.000Z" title="发表于 2024-04-01 00:00:00">2024-04-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/elk/3d7c2057-e448-4b83-a185-8d98e973490e.html" title="Nginx 的安装与使用"><img src="/images/hexo.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Nginx 的安装与使用"></a><div class="content"><a class="title" href="/elk/3d7c2057-e448-4b83-a185-8d98e973490e.html" title="Nginx 的安装与使用">Nginx 的安装与使用</a><time datetime="2024-03-10T16:00:00.000Z" title="发表于 2024-03-11 00:00:00">2024-03-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/games/967c02f7-0d5e-4dd8-a2e0-70c97840fc5d.html" title="真三国无双 7 攻略"><img src="/images/hexo.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="真三国无双 7 攻略"></a><div class="content"><a class="title" href="/games/967c02f7-0d5e-4dd8-a2e0-70c97840fc5d.html" title="真三国无双 7 攻略">真三国无双 7 攻略</a><time datetime="2024-02-29T16:00:00.000Z" title="发表于 2024-03-01 00:00:00">2024-03-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/docker/4c765195-289e-4cc4-88fb-12d9bb5fed61.html" title="Docker Compose 使用"><img src="/images/hexo.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Docker Compose 使用"></a><div class="content"><a class="title" href="/docker/4c765195-289e-4cc4-88fb-12d9bb5fed61.html" title="Docker Compose 使用">Docker Compose 使用</a><time datetime="2023-12-31T16:00:00.000Z" title="发表于 2024-01-01 00:00:00">2024-01-01</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2024 By Janvy Sun</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> 数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><script>var preloader={endLoading:()=>{document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.body.style.overflow="",document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",preloader.endLoading())</script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>